<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>我的旅遊手帳 V47</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: #FFF9F5;
            overscroll-behavior-y: none;
            -webkit-tap-highlight-color: transparent;
            transition: font-size 0.3s; /* Smooth font size transition */
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .soft-shadow { box-shadow: 0 8px 30px rgba(0,0,0,0.06); }
        .card-press:active { transform: scale(0.98); transition: transform 0.1s; }
        
        /* Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #ffffff;
            border: 2px solid currentColor;
            cursor: pointer;
            margin-top: -8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #e2e8f0;
            border-radius: 2px;
        }

        /* 飄落動畫 */
        @keyframes fall {
            0% { transform: translateY(-10vh) translateX(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(110vh) translateX(20px) rotate(360deg); opacity: 0; }
        }
        .falling-item {
            position: fixed;
            top: -10%;
            user-select: none;
            pointer-events: none;
            z-index: 0;
            animation-name: fall;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
        }
    </style>
</head>
<body class="h-screen w-screen overflow-hidden text-slate-700" :style="{ fontSize: settings.fontSize + 'px' }">

    <div id="app" class="h-full flex flex-col relative transition-colors duration-700" :style="{ backgroundColor: currentTheme.bg }">

        <div v-if="currentEffect !== 'none'" class="absolute inset-0 overflow-hidden pointer-events-none z-0">
            <div v-for="n in 15" :key="n" class="falling-item text-xl opacity-60" 
                 :style="{ 
                    left: Math.random() * 100 + 'vw', 
                    animationDuration: (Math.random() * 5 + 5) + 's', 
                    animationDelay: (Math.random() * 5) + 's',
                    color: currentTheme.main
                 }">
                <i :class="effectIcon"></i>
            </div>
        </div>

        <div v-if="currentView === 'home'" class="flex-1 flex flex-col p-6 z-10 overflow-y-auto pt-12">
            
            <div class="mb-8 flex justify-between items-end">
                <div>
                    <h1 class="text-3xl font-bold text-slate-800">我的旅程</h1>
                    <p class="text-sm text-gray-400 mt-1">開始規劃你的下一趟旅行 ✈️</p>
                </div>
                <button @click="showSettings = true" class="w-10 h-10 rounded-full bg-white soft-shadow flex items-center justify-center text-gray-400 hover:text-gray-600 transition-colors">
                    <i class="fa-solid fa-gear"></i>
                </button>
            </div>

            <div class="space-y-6">
                
                <div @click="selectTrip('karuizawa')" class="bg-white rounded-[30px] p-0 soft-shadow overflow-hidden card-press cursor-pointer group relative">
                    <div class="h-40 bg-cover bg-center relative" :style="{ backgroundImage: `url(${trips.karuizawa.headerImg})` }">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
                        <div class="absolute bottom-4 left-5 text-white">
                            <h3 class="text-2xl font-bold shadow-sm">{{ trips.karuizawa.name }}</h3>
                            <p class="text-xs opacity-90"><i class="fa-solid fa-location-dot mr-1"></i>東京、輕井澤</p>
                        </div>
                    </div>
                    <div class="p-5 flex justify-between items-center">
                        <div>
                            <div class="text-xs text-gray-400 mb-1 font-bold">距離出發</div>
                            <div class="text-3xl font-bold font-mono" :style="{ color: themes.pink.main }">{{ getCountdown('2026-04-18') }} <span class="text-sm text-gray-400 font-sans font-normal">天</span></div>
                        </div>
                        <div class="w-12 h-12 rounded-full flex items-center justify-center text-white text-xl shadow-md" :style="{ backgroundColor: themes.pink.main }">
                            <i class="fa-solid fa-chevron-right"></i>
                        </div>
                    </div>
                </div>

                <div @click="selectTrip('central')" class="bg-white rounded-[30px] p-0 soft-shadow overflow-hidden card-press cursor-pointer group relative">
                    <div class="h-40 bg-cover bg-center relative" :style="{ backgroundImage: `url(${trips.central.headerImg})` }">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
                        <div class="absolute bottom-4 left-5 text-white">
                            <h3 class="text-2xl font-bold shadow-sm">{{ trips.central.name }}</h3>
                            <p class="text-xs opacity-90"><i class="fa-solid fa-location-dot mr-1"></i>名古屋、高山</p>
                        </div>
                    </div>
                    <div class="p-5 flex justify-between items-center">
                        <div>
                            <div class="text-xs text-gray-400 mb-1 font-bold">距離出發</div>
                            <div class="text-3xl font-bold font-mono" :style="{ color: themes.orange.main }">{{ getCountdown('2026-10-31') }} <span class="text-sm text-gray-400 font-sans font-normal">天</span></div>
                        </div>
                        <div class="w-12 h-12 rounded-full flex items-center justify-center text-white text-xl shadow-md" :style="{ backgroundColor: themes.orange.main }">
                            <i class="fa-solid fa-chevron-right"></i>
                        </div>
                    </div>
                </div>

                 <div class="border-2 border-dashed border-gray-300 rounded-[30px] p-6 flex flex-col items-center justify-center text-gray-400 card-press cursor-pointer h-32 opacity-60 hover:opacity-100 transition-opacity">
                    <i class="fa-solid fa-plus text-3xl mb-2"></i>
                    <span class="font-bold">新增旅程</span>
                </div>
            </div>
        </div>


        <div v-if="currentView === 'detail'" class="flex-1 flex flex-col relative z-10 h-full">
            
            <div class="relative h-[220px] flex-shrink-0 bg-cover bg-center transition-all duration-500"
                 :style="{ backgroundImage: `url(${activeTrip.headerImg})` }">
                
                <div class="absolute inset-0 bg-gradient-to-b from-black/30 to-black/70"></div>
                
                <button @click="currentView = 'home'" class="absolute top-6 left-4 w-10 h-10 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center text-white z-50 hover:bg-white/30 transition">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                
                 <button @click="showSettings = true" class="absolute top-6 right-4 w-10 h-10 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center text-white z-50 hover:bg-white/30 transition">
                    <i class="fa-solid fa-gear"></i>
                </button>

                <div class="absolute bottom-8 right-4 flex space-x-3 z-20">
                    <button @click="activeTab = 'itinerary'" :class="tabClass('itinerary')"><i class="fa-solid fa-map-location-dot text-lg"></i></button>
                    <button @click="activeTab = 'info'" :class="tabClass('info')"><i class="fa-solid fa-circle-info text-lg"></i></button>
                    <button @click="activeTab = 'shopping'" :class="tabClass('shopping')"><i class="fa-solid fa-basket-shopping text-lg"></i></button>
                    <button @click="activeTab = 'expenses'" :class="tabClass('expenses')"><i class="fa-solid fa-yen-sign text-lg"></i></button>
                </div>
                
                <div class="absolute bottom-10 left-6 text-white text-shadow drop-shadow-lg">
                    <h1 class="text-2xl font-bold tracking-widest">{{ activeTrip.name }}</h1>
                    <p class="text-sm opacity-90"><i class="fa-solid fa-calendar mr-1"></i> {{ activeTrip.range }}</p>
                </div>
            </div>

            <div class="flex-1 rounded-t-[30px] -mt-6 relative z-10 overflow-hidden flex flex-col shadow-[0_-5px_20px_rgba(0,0,0,0.1)]" :style="{ backgroundColor: currentTheme.bg }">
                <div class="flex-1 overflow-y-auto no-scrollbar pb-24">

                    <div v-if="activeTab === 'itinerary'">
                        
                        <div class="sticky top-0 z-40 px-5 pt-5 pb-2 transition-all duration-300" :style="{ backgroundColor: currentTheme.bg }">
                            <div class="bg-white rounded-2xl p-4 soft-shadow flex justify-between items-center border border-gray-50">
                                <div>
                                    <div class="text-xs text-gray-400 font-bold mb-0.5">距離出發</div>
                                    <div class="text-2xl font-bold font-mono" :style="{ color: currentTheme.main }">
                                        {{ getCountdown(activeTrip.date) }} <span class="text-xs text-gray-400 font-sans font-normal">天</span>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-xs text-gray-400">{{ activeTrip.weatherCity }}</div>
                                    <div class="flex items-center gap-1 justify-end">
                                        <i :class="['fa-solid', weather.icon]" :style="{ color: currentTheme.main }"></i>
                                        <span class="font-bold text-slate-600">{{ weather.temp }}°</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="flex space-x-3 overflow-x-auto no-scrollbar px-5 py-2">
                            <div v-for="(day, index) in activeTrip.days" :key="index" 
                                 @click="selectedDayIndex = index"
                                 class="flex-shrink-0 flex flex-col items-center justify-center w-14 h-16 rounded-xl transition-all duration-300 snap-center cursor-pointer border border-white/50 soft-shadow"
                                 :class="selectedDayIndex === index ? 'text-white shadow-lg scale-105' : 'bg-white text-gray-400'"
                                 :style="{ backgroundColor: selectedDayIndex === index ? currentTheme.main : 'white' }">
                                <span class="text-[10px] font-bold uppercase">{{ day.weekday }}</span>
                                <span class="text-lg font-bold">{{ day.dateStr.split('/')[1] }}</span>
                            </div>
                        </div>

                        <div class="px-5 pt-4 space-y-0 relative">
                            <div class="absolute left-[21px] top-4 bottom-4 w-0.5 bg-gray-200 z-0"></div>

                            <div v-for="(item, idx) in currentDayEvents" :key="idx" class="relative pl-10 pb-8 group">
                                
                                <div v-if="idx > 0" class="absolute -top-7 left-10 right-0 flex items-center text-[10px] text-gray-400 mb-2 z-50">
                                    <span class="bg-white px-2 py-0.5 rounded-full border border-gray-100 flex items-center gap-1 shadow-sm">
                                        <i :class="getTransportIcon(item.transportType)"></i>
                                        {{ item.travelTime || '移動' }}
                                    </span>
                                </div>

                                <div class="absolute left-0 top-3 w-11 h-11 rounded-full bg-white border-4 flex items-center justify-center z-10 shadow-sm font-bold text-xs" :style="{ borderColor: 'white', color: currentTheme.main }">
                                    {{ item.time.split(':')[0] }}
                                </div>

                                <div class="bg-white rounded-2xl p-4 soft-shadow relative overflow-hidden transition-all active:scale-95 border-l-4"
                                     :style="{ borderLeftColor: item.category === 'highlight' ? '#F59E0B' : currentTheme.main }">
                                    
                                    <div @click="openMap(item.loc)">
                                        <div class="flex justify-between items-start mb-1">
                                            <div class="text-xs font-bold uppercase tracking-wider opacity-70" :style="{ color: currentTheme.main }">{{ item.time }} • {{ itemCategoryName(item.category) }}</div>
                                        </div>
                                        
                                        <h3 class="text-lg font-bold mb-1 leading-tight text-slate-800">{{ item.title }}</h3>
                                        
                                        <div class="text-sm text-gray-500 mb-2 flex items-start gap-1" v-if="item.desc">
                                            <i class="fa-regular fa-note-sticky mt-0.5 text-xs flex-shrink-0" :style="{ color: currentTheme.main }"></i>
                                            <span class="whitespace-pre-line text-xs">{{ item.desc }}</span>
                                        </div>

                                        <div class="flex flex-wrap gap-2 mt-2">
                                            <span v-if="item.desc && item.desc.includes('MC:')" class="text-[10px] bg-blue-50 text-blue-600 px-2 py-1 rounded-md font-bold border border-blue-100">
                                                <i class="fa-solid fa-map-pin mr-1"></i>MapCode
                                            </span>
                                            <span v-if="item.category === 'highlight'" class="text-[10px] bg-yellow-50 text-yellow-600 px-2 py-1 rounded-md font-bold border border-yellow-100">
                                                <i class="fa-solid fa-heart mr-1"></i>紀念日
                                            </span>
                                            <span v-if="item.loc" class="text-[10px] bg-gray-50 text-gray-500 px-2 py-1 rounded-md border border-gray-100">
                                                <i class="fa-solid fa-location-arrow mr-1"></i>導航
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div v-if="currentDayEvents.length === 0" class="text-center text-gray-400 py-10">
                                <i class="fa-solid fa-calendar-plus text-4xl mb-3 opacity-30"></i>
                                <p>點擊右下角新增行程</p>
                            </div>
                        </div>
                    </div>

                    <div v-if="activeTab === 'info'" class="space-y-6 px-5 pt-5">
                        <div class="bg-white rounded-2xl p-0 soft-shadow overflow-hidden border-l-4" :style="{ borderLeftColor: currentTheme.main }">
                            <div class="bg-gray-50 p-3 font-bold flex justify-between items-center" :style="{ color: currentTheme.main }">
                                <span><i class="fa-solid fa-file-lines mr-2"></i>完整 Google Doc 行程</span>
                            </div>
                            <div class="p-4">
                                <a :href="activeTrip.docLink" target="_blank" class="block w-full text-white font-bold py-3 rounded-xl shadow-md hover:opacity-90 transition-colors text-center" :style="{ backgroundColor: currentTheme.main }">
                                    <i class="fa-brands fa-google-drive mr-2"></i> 點擊查看文檔
                                </a>
                            </div>
                        </div>
                         <div class="bg-white rounded-2xl p-0 soft-shadow overflow-hidden border-2 border-red-100">
                            <div class="bg-red-50 p-3 text-red-600 font-bold flex justify-between items-center">
                                <span><i class="fa-regular fa-clock mr-2"></i>關鍵行動鬧鐘 (Set Alarm)</span>
                            </div>
                            <div class="p-4 space-y-3 text-xs">
                                <div v-for="(alarm, idx) in activeTrip.alarms" :key="idx" class="flex gap-2 border-b border-gray-50 pb-2 last:border-0 last:pb-0">
                                    <span class="font-bold w-12 text-red-500">{{ alarm.date }}</span> 
                                    <span>{{ alarm.task }}</span>
                                </div>
                            </div>
                        </div>
                         <div class="bg-white rounded-2xl p-0 soft-shadow overflow-hidden">
                            <div class="p-3 text-white font-bold flex justify-between" :style="{ backgroundColor: currentTheme.main }">
                                <span><i class="fa-solid fa-plane mr-2"></i>航班資訊 (CX)</span>
                            </div>
                            <div class="p-5">
                                <div class="mb-4">
                                    <div class="flex justify-between text-xs text-gray-400 mb-1"><span>去程 (HKG → JP)</span></div>
                                    <div class="flex justify-between items-center mb-1">
                                        <div class="text-2xl font-bold text-slate-700">{{ activeTrip.flights.out.dep }}</div>
                                        <div class="h-0.5 w-10 bg-gray-200 relative flex justify-center"><i class="fa-solid fa-plane text-gray-400 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"></i></div>
                                        <div class="text-2xl font-bold text-slate-700">{{ activeTrip.flights.out.arr }}</div>
                                    </div>
                                    <div class="flex justify-between text-sm font-bold bg-gray-50 p-2 rounded-lg">
                                        <span>{{ activeTrip.flights.out.code }}</span>
                                        <span>{{ activeTrip.flights.out.date }}</span>
                                    </div>
                                    <a :href="`https://www.google.com/search?q=${activeTrip.flights.out.code}+flight+status`" target="_blank" class="block w-full text-center py-2 rounded-lg border border-gray-300 text-gray-500 text-sm font-bold hover:bg-gray-50 transition-colors mt-2">
                                        <i class="fa-solid fa-wifi mr-1"></i> 查看即時狀態
                                    </a>
                                </div>
                                <div class="border-t border-dashed border-gray-200 my-4"></div>
                                <div>
                                    <div class="flex justify-between text-xs text-gray-400 mb-1"><span>回程 (JP → HKG)</span></div>
                                    <div class="flex justify-between items-center mb-1">
                                        <div class="text-2xl font-bold text-slate-700">{{ activeTrip.flights.in.dep }}</div>
                                        <div class="h-0.5 w-10 bg-gray-200 relative flex justify-center"><i class="fa-solid fa-plane text-gray-400 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"></i></div>
                                        <div class="text-2xl font-bold text-slate-700">{{ activeTrip.flights.in.arr }}</div>
                                    </div>
                                    <div class="flex justify-between text-sm font-bold bg-gray-50 p-2 rounded-lg mb-2">
                                        <span>{{ activeTrip.flights.in.code }}</span>
                                        <span>{{ activeTrip.flights.in.date }}</span>
                                    </div>
                                    <a :href="`https://www.google.com/search?q=${activeTrip.flights.in.code}+flight+status`" target="_blank" class="block w-full text-center py-2 rounded-lg border border-gray-300 text-gray-500 text-sm font-bold hover:bg-gray-50 transition-colors">
                                        <i class="fa-solid fa-wifi mr-1"></i> 查看即時狀態
                                    </a>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-2xl p-5 soft-shadow">
                            <h3 class="font-bold mb-3" :style="{ color: currentTheme.main }"><i class="fa-solid fa-coins mr-2"></i>匯率換算</h3>
                            <div class="flex items-center gap-2 mb-2">
                                <div class="flex-1 bg-gray-50 rounded-lg p-2 flex items-center">
                                    <span class="text-gray-400 mr-2 text-sm">JPY</span>
                                    <input type="number" v-model="calcJpy" @input="convert('jpy')" class="w-full bg-transparent outline-none font-bold text-lg" placeholder="0">
                                </div>
                                <i class="fa-solid fa-arrow-right-arrow-left text-gray-300"></i>
                                <div class="flex-1 bg-gray-50 rounded-lg p-2 flex items-center">
                                    <span class="text-gray-400 mr-2 text-sm">HKD</span>
                                    <input type="number" v-model="calcHkd" @input="convert('hkd')" class="w-full bg-transparent outline-none font-bold text-lg" placeholder="0">
                                </div>
                            </div>
                            <div class="text-right text-xs text-gray-400">匯率: {{ exchangeRate }} (JPY -> HKD)</div>
                        </div>

                        <div class="bg-white rounded-2xl p-0 soft-shadow overflow-hidden" v-if="activeTrip.rental">
                            <div class="bg-blue-50 p-3 text-blue-600 font-bold flex justify-between">
                                <span><i class="fa-solid fa-car mr-2"></i>租車 (Compact SUV)</span>
                            </div>
                            <div class="p-5 text-sm space-y-2">
                                <p><strong>取車:</strong> {{ activeTrip.rental.pickup }}</p>
                                <p><strong>還車:</strong> {{ activeTrip.rental.return }}</p>
                                <p><strong>保險:</strong> {{ activeTrip.rental.insurance }}</p>
                                <p v-if="activeTrip.rental.note" class="text-red-500 font-bold"><i class="fa-solid fa-snowflake mr-1"></i>{{ activeTrip.rental.note }}</p>
                                <p v-if="activeTrip.rental.no"><strong>預約號碼:</strong> <span class="text-lg font-bold">{{ activeTrip.rental.no }}</span></p>
                            </div>
                        </div>

                        <div class="space-y-4">
                            <h3 class="font-bold text-gray-500 ml-1">住宿列表</h3>
                            <div v-for="hotel in activeTrip.hotels" :key="hotel.name" class="bg-white rounded-2xl p-4 soft-shadow flex items-center gap-4" @click="openMap(hotel.name)">
                                <div class="w-12 h-12 rounded-full flex items-center justify-center text-white text-xl" :style="{ backgroundColor: currentTheme.main }">
                                    <i class="fa-solid fa-bed"></i>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-bold text-sm">{{ hotel.name }}</h4>
                                    <p class="text-xs text-gray-400 mt-1">{{ hotel.dates }}</p>
                                    <p v-if="hotel.note" class="text-[10px] text-red-400 mt-1"><i class="fa-solid fa-gift mr-1"></i>{{ hotel.note }}</p>
                                </div>
                                <i class="fa-solid fa-chevron-right text-gray-300"></i>
                            </div>
                        </div>
                    </div>

                    <div v-if="activeTab === 'shopping'" class="px-5 pt-5">
                         <div class="bg-white rounded-2xl p-4 soft-shadow mb-4">
                            <h3 class="font-bold mb-3">待購清單</h3>
                            <div class="space-y-3">
                                <div v-for="(item, idx) in activeTrip.shopping" :key="idx" class="flex items-center gap-3 p-3 bg-white border border-gray-100 rounded-xl shadow-sm">
                                    <input type="checkbox" class="w-5 h-5 rounded border-gray-300" :class="`accent-${activeTrip.theme}-500`">
                                    <span class="text-sm font-bold">{{ item }}</span>
                                    <button @click="removeShoppingItem(idx)" class="ml-auto text-gray-300 hover:text-red-400"><i class="fa-solid fa-trash"></i></button>
                                </div>
                                <div class="flex gap-2 mt-4">
                                    <input v-model="newShopItem" placeholder="新增物品..." class="flex-1 bg-gray-100 p-3 rounded-xl text-sm outline-none">
                                    <button @click="addShoppingItem" class="w-12 h-12 rounded-xl text-white flex items-center justify-center shadow-md transition-transform active:scale-95" :style="{ backgroundColor: currentTheme.main }"><i class="fa-solid fa-plus"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div v-if="activeTab === 'expenses'" class="px-5 pt-5">
                        <div class="bg-white rounded-3xl p-6 soft-shadow mb-6 text-center" :style="{ backgroundColor: currentTheme.main }">
                            <p class="text-xs text-white/80 mb-1">總花費 (HKD)</p>
                            <div class="text-4xl font-bold text-white">${{ totalExpenses.toLocaleString() }}</div>
                        </div>
                        <div class="bg-white rounded-2xl p-4 soft-shadow">
                            <div v-for="(exp, idx) in activeTrip.expenses" :key="idx" class="flex justify-between items-center py-3 border-b border-gray-100 last:border-0">
                                <div>
                                    <div class="font-bold text-sm">{{ exp.item }}</div>
                                    <div class="text-xs text-gray-400">{{ exp.date }} • {{ exp.cat }}</div>
                                </div>
                                <div class="flex items-center gap-3">
                                    <div class="font-bold" :style="{ color: currentTheme.main }">¥{{ exp.amount }}</div>
                                    <button @click="deleteExpense(idx)" class="text-gray-300 text-xs"><i class="fa-solid fa-trash"></i></button>
                                </div>
                            </div>
                            <div v-if="activeTrip.expenses.length === 0" class="text-center text-gray-400 py-4 text-sm">暫無紀錄</div>
                        </div>
                        <button class="w-full mt-4 py-3 rounded-xl text-white font-bold shadow-md transition-transform active:scale-95" :style="{ backgroundColor: currentTheme.main }">記一筆</button>
                    </div>

                </div>
            </div>
        </div>

        <button v-if="currentView === 'detail' && activeTab === 'itinerary'" @click="openAddModal" class="absolute bottom-8 right-6 w-14 h-14 rounded-full shadow-lg flex items-center justify-center text-2xl z-50 text-white transition-transform active:scale-90" :style="{ backgroundColor: currentTheme.main }">
            <i class="fa-solid fa-plus"></i>
        </button>

        <div v-if="showSettings" class="fixed inset-0 z-[60] bg-black/50 backdrop-blur-sm flex items-end sm:items-center justify-center" @click.self="showSettings = false">
            <div class="bg-white w-full sm:w-96 rounded-t-3xl sm:rounded-3xl p-6 animate-slide-up">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold" :style="{ color: currentTheme.main }">設定</h3>
                    <button @click="showSettings = false" class="text-gray-400"><i class="fa-solid fa-xmark text-xl"></i></button>
                </div>
                
                <div class="space-y-8">
                    <div>
                        <label class="text-sm font-bold text-gray-500 mb-3 block flex items-center gap-2"><i class="fa-solid fa-palette"></i> 主題顏色</label>
                        <div class="flex gap-4">
                            <button @click="changeTheme('pink')" class="w-12 h-12 rounded-full bg-[#DB7093] ring-2 ring-offset-2 transition-transform active:scale-90" :class="settings.themeColor === 'pink' ? 'ring-[#DB7093]' : 'ring-transparent'"></button>
                            <button @click="changeTheme('orange')" class="w-12 h-12 rounded-full bg-[#C05621] ring-2 ring-offset-2 transition-transform active:scale-90" :class="settings.themeColor === 'orange' ? 'ring-[#C05621]' : 'ring-transparent'"></button>
                            <button @click="changeTheme('blue')" class="w-12 h-12 rounded-full bg-[#2563EB] ring-2 ring-offset-2 transition-transform active:scale-90" :class="settings.themeColor === 'blue' ? 'ring-[#2563EB]' : 'ring-transparent'"></button>
                        </div>
                    </div>

                    <div>
                        <div class="flex justify-between mb-2">
                             <label class="text-sm font-bold text-gray-500 flex items-center gap-2"><i class="fa-solid fa-font"></i> 字體大小</label>
                             <span class="text-xs text-gray-400">{{ settings.fontSize }}px</span>
                        </div>
                        <div class="flex items-center gap-4 bg-gray-50 p-3 rounded-xl">
                            <span class="text-xs">小</span>
                            <input type="range" min="14" max="20" step="1" v-model="settings.fontSize" class="flex-1" :style="{ color: currentTheme.main }">
                            <span class="text-lg">大</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="showModal" class="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/50 backdrop-blur-sm" @click.self="showModal = false">
             <div class="bg-white w-full sm:w-96 rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl animate-slide-up">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold" :style="{ color: currentTheme.main }">新增項目</h3>
                    <button @click="showModal = false" class="text-gray-400"><i class="fa-solid fa-xmark text-xl"></i></button>
                </div>
                <div class="space-y-4">
                    <input v-model="newItem.title" type="text" placeholder="標題 / 項目名稱" class="w-full p-3 bg-gray-50 rounded-xl border-none outline-none">
                    <div class="flex gap-2">
                        <input v-model="newItem.time" type="time" class="w-1/3 p-3 bg-gray-50 rounded-xl outline-none">
                        <select v-model="newItem.category" class="w-2/3 p-3 bg-gray-50 rounded-xl outline-none">
                            <option value="sightseeing">景點</option>
                            <option value="food">美食</option>
                            <option value="shopping">購物</option>
                        </select>
                    </div>
                </div>
                <button @click="confirmAdd" class="w-full text-white font-bold py-4 rounded-xl mt-6 shadow-lg" :style="{ backgroundColor: currentTheme.main }">確認新增</button>
            </div>
        </div>

    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    currentView: 'home', 
                    selectedTripId: 'karuizawa', 
                    activeTab: 'itinerary',
                    selectedDayIndex: 0,
                    showModal: false,
                    showSettings: false,
                    newShopItem: '',
                    
                    exchangeRate: 0.053,
                    calcJpy: '',
                    calcHkd: '',
                    
                    weather: { city_name: '', temp: '--', feels_like: '--', icon: 'fa-spinner fa-spin' },
                    apiKey: 'cc2dab2806da14aec6dab2ed8260a1c4',
                    
                    // Global Settings
                    settings: {
                        themeColor: 'pink', // Initial default
                        effect: 'flower',
                        fontSize: 16
                    },

                    themes: {
                        pink: { main: '#DB7093', bg: '#FFF0F5' },   
                        orange: { main: '#C05621', bg: '#FFFAF0' },
                        blue: { main: '#2563EB', bg: '#EFF6FF' }
                    },

                    trips: {
                        karuizawa: {
                            id: 'karuizawa',
                            name: '東京櫻花之旅 2026',
                            date: '2026-04-18',
                            range: 'Apr 18 - 25, 2026',
                            theme: 'pink',
                            effect: 'flower',
                            headerImg: './header_karuizawa.jpg',
                            docLink: 'https://docs.google.com/document/d/1-4mgjTycE9bGWhuitIkigPSM4_0fBPlZX2RoVRCTlXw/edit?usp=drivesdk',
                            weatherCity: 'Karuizawa,JP',
                            
                            flights: {
                                out: { code: 'CX524', date: '4/18', dep: '01:00', arr: '06:40' },
                                in: { code: 'CX501', date: '4/25', dep: '21:30', arr: '02:00' }
                            },
                            rental: {
                                company: 'Toyota Rent a Car',
                                pickup: '4/20 09:30 @ T-CAT (水天宮)',
                                return: '4/22 17:00 @ T-CAT (水天宮)',
                                insurance: 'NOC 安心保險',
                                no: '98147748300',
                                note: ''
                            },
                            hotels: [
                                { name: 'VIA INN PRIME 日本橋人形町', dates: '4/18 - 4/20' },
                                { name: 'Toyoko Inn 佐久平站淺間口', dates: '4/20 - 4/22' },
                                { name: '八重翠東京酒店', dates: '4/22 - 4/25' }
                            ],
                            alarms: [
                                { date: '即刻', task: '買機票' },
                                { date: '1/20', task: 'Book 輕井澤燒肉' },
                                { date: '3/23', task: '搶 Disney Pass' }
                            ],
                            shopping: [],
                            expenses: [],
                            
                            days: [
                                { weekday: 'Sat', dateStr: '4/18', events: [
                                    { time: '06:40', title: '抵達成田 (NRT)', desc: '橙色櫃台買飛去 T-CAT', category: 'flight', loc: 'Narita Airport', transportType: 'flight' },
                                    { time: '07:45', title: '巴士 -> T-CAT', desc: '利木津巴士，4個喼寄艙', category: 'transport', loc: 'T-CAT', transportType: 'bus', travelTime: '75 min' },
                                    { time: '09:00', title: 'Check-in 酒店', desc: '的士直達 VIA INN PRIME', category: 'hotel', loc: 'VIA INN PRIME Nihonbashi', transportType: 'car', travelTime: '10 min' },
                                    { time: '11:00', title: '利久牛舌 (午餐)', desc: '上野 Parco_ya 6F，「極」定食', category: 'food', loc: 'Rikyu Ueno', transportType: 'train', travelTime: '30 min' },
                                    { time: '13:00', title: '根津神社', desc: '杜鵑花祭', category: 'sightseeing', loc: 'Nezu Shrine', transportType: 'bus', travelTime: '20 min' },
                                    { time: '15:30', title: '淺草散步', desc: '雷門/仲見世通', category: 'sightseeing', loc: 'Sensoji', transportType: 'bus', travelTime: '25 min' },
                                    { time: '17:00', title: '米久本店', desc: '百年牛鍋 (壽喜燒)', category: 'food', loc: 'Yonekyu Honten', transportType: 'walk', travelTime: '10 min' }
                                ]},
                                { weekday: 'Sun', dateStr: '4/19', events: [
                                    { time: '09:30', title: '龜戶天神社', desc: '紫藤花 (水天宮前->錦糸町)', category: 'sightseeing', loc: 'Kameido Tenjin', transportType: 'train', travelTime: '30 min' },
                                    { time: '12:30', title: '山笑ふ (午餐)', desc: '表參道店 Shabu Shabu (已預約)', category: 'food', loc: 'Yama Warau Omotesando', transportType: 'train', travelTime: '45 min' },
                                    { time: '14:30', title: 'Harakado', desc: '7F 屋頂花園', category: 'sightseeing', loc: 'Harakado', transportType: 'walk', travelTime: '5 min' },
                                    { time: '19:00', title: '牛かつもと村', desc: '澀谷分店 炸牛排', category: 'food', loc: 'Gyukatsu Motomura Shibuya', transportType: 'walk', travelTime: '20 min' }
                                ]},
                                { weekday: 'Mon', dateStr: '4/20', events: [
                                    { time: '09:00', title: 'Check-out', desc: '行去 T-CAT', category: 'other', loc: 'T-CAT', transportType: 'walk' },
                                    { time: '09:30', title: '取車', desc: 'Toyota T-CAT (No: 98147748300)', category: 'transport', loc: 'Toyota Rent a Car T-CAT', transportType: 'walk' },
                                    { time: '10:30', title: '三芳 PA', desc: '休息站', category: 'transport', loc: 'Miyoshi PA', transportType: 'car', travelTime: '60 min (45km)' },
                                    { time: '13:00', title: '輕井澤午餐', desc: '川上庵 或 村民食堂', category: 'food', loc: 'Karuizawa', transportType: 'car', travelTime: '90 min (120km)' },
                                    { time: '14:30', title: 'Outlet Shopping', desc: 'MC: 292 677 245*55 (泊 P7)', category: 'shopping', loc: 'Prince Shopping Plaza', transportType: 'car', travelTime: '20 min' },
                                    { time: '18:00', title: 'Check-in', desc: 'Toyoko Inn 佐久平', category: 'hotel', loc: 'Toyoko Inn Sakudaira', transportType: 'car', travelTime: '40 min (30km)' },
                                    { time: '20:00', title: '暖暮拉麵', desc: 'Aeon Mall 佐久平 2樓', category: 'food', loc: 'Danbo Ramen Sakudaira', transportType: 'walk', travelTime: '8 min' }
                                ]},
                                { weekday: 'Tue', dateStr: '4/21', events: [
                                    { time: '08:00', title: 'Pre-wedding', desc: '全日拍攝 (自駕移動)', category: 'highlight', loc: 'Karuizawa', transportType: 'car' },
                                    { time: '19:00', title: '慶功晚餐', desc: '川上庵 或 燒肉', category: 'food', loc: 'Karuizawa', transportType: 'car' }
                                ]},
                                { weekday: 'Wed', dateStr: '4/22', events: [
                                    { time: '10:00', title: '白絲瀑布', desc: 'MC: 292 701 645*63', category: 'sightseeing', loc: 'Shiraito Falls', transportType: 'car', travelTime: '45 min' },
                                    { time: '11:00', title: 'Rogotei 燒肉', desc: '午餐', category: 'food', loc: 'Rogotei', transportType: 'car', travelTime: '30 min' },
                                    { time: '12:30', title: '舊輕井澤銀座通', desc: '掃街、布丁', category: 'sightseeing', loc: 'Kyu-Karuizawa Ginza', transportType: 'car' },
                                    { time: '14:00', title: '橫川 SA', desc: '釜飯便當', category: 'food', loc: 'Yokokawa SA', transportType: 'car', travelTime: '45 min (35km)' },
                                    { time: '17:00', title: '東京還車', desc: 'T-CAT B1 停車場', category: 'transport', loc: 'T-CAT', transportType: 'car', travelTime: '2.5 hr (130km)' },
                                    { time: '18:00', title: 'Check-in', desc: '八重翠東京酒店', category: 'hotel', loc: 'Yaekit', transportType: 'walk', travelTime: '15 min' },
                                    { time: '20:45', title: '壽司郎', desc: '八重洲地下街 南1號', category: 'food', loc: 'Sushiro Yaesu', transportType: 'walk', travelTime: '10 min' },
                                    { time: '21:30', title: '返酒店開餐', desc: '八重翠東京酒店', category: 'hotel', loc: 'Yaekit', transportType: 'walk' }
                                ]},
                                { weekday: 'Thu', dateStr: '4/23', events: [
                                    { time: '06:45', title: '出發 Disney', desc: '八丁堀 -> 舞濱 (07:30 到門口)', category: 'transport', loc: 'Maihama', transportType: 'train', travelTime: '45 min' },
                                    { time: '08:30', title: 'Disney Sea', desc: '搶 Standby Pass (Frozen)', category: 'ticket', loc: 'Tokyo DisneySea', transportType: 'walk' },
                                    { time: '13:00', title: '午餐', desc: 'Mobile Order 慳時間', category: 'food', loc: 'DisneySea' },
                                    { time: '20:30', title: '撤退回程', desc: '單軌 -> 京葉線 -> 八丁堀', category: 'transport', loc: 'Hatchobori', transportType: 'train', travelTime: '30 min' },
                                    { time: '21:00', title: '救命晚餐', desc: '麥當勞 (Samurai Mac 厚牛堡)', category: 'food', loc: 'McDonalds Hatchobori', transportType: 'walk', travelTime: '15 min' }
                                ]},
                                { weekday: 'Fri', dateStr: '4/24', events: [
                                    { time: '09:30', title: '前往豐洲', desc: '的士 (約 ¥2000)', category: 'transport', loc: 'Toyosu Market', transportType: 'car', travelTime: '15 min' },
                                    { time: '10:00', title: '大和壽司', desc: '需排隊', category: 'food', loc: 'Daiwa Sushi', transportType: 'walk' },
                                    { time: '13:30', title: 'TeamLab Planets', desc: '新豐洲站旁', category: 'sightseeing', loc: 'TeamLab Planets', transportType: 'walk' },
                                    { time: '18:30', title: '銀座 篝', desc: '雞白湯拉麵', category: 'food', loc: 'Ginza Kagari', transportType: 'train', travelTime: '20 min' }
                                ]},
                                { weekday: 'Sat', dateStr: '4/25', events: [
                                    { time: '10:30', title: '東京一番街', desc: 'Character Street', category: 'shopping', loc: 'Tokyo Station', transportType: 'walk' },
                                    { time: '12:00', title: 'Manten Sushi', desc: '丸之內店', category: 'food', loc: 'Manten Sushi Marunouchi', transportType: 'walk' },
                                    { time: '14:30', title: 'T-CAT 寄行李', desc: '3樓買飛', category: 'transport', loc: 'T-CAT', transportType: 'car' },
                                    { time: '14:45', title: '前往機場', desc: 'CX501 回程', category: 'transport', loc: 'Narita Airport', transportType: 'bus', travelTime: '60 min' }
                                ]}
                            ]
                        },
                        central: {
                            id: 'central',
                            name: '日本中部紅葉之旅',
                            date: '2026-10-31', 
                            range: 'Oct 31 - Nov 08, 2026',
                            theme: 'orange',
                            effect: 'leaf',
                            headerImg: './header_central.jpg',
                            docLink: 'https://docs.google.com/document/d/11eFLaGqOmRfXx90pVCWGF0iNIQRwECa3X3VmFjqQgdk/edit?usp=drivesdk',
                            weatherCity: 'Nagoya,JP',

                            // Info Tab 數據
                            flights: {
                                out: { code: 'CX524', date: '10/31', dep: '01:00', arr: '06:40' },
                                in: { code: 'CX505', date: '11/08', dep: '18:00', arr: '22:25' }
                            },
                            rental: {
                                company: 'Toyota Rent a Car',
                                pickup: '10/31 08:00 @ 成田機場',
                                return: '11/05 18:00 @ 淺草/上野',
                                insurance: 'NOC 安心保險',
                                note: '必須指定雪胎 (Snow Tires)'
                            },
                            hotels: [
                                { name: 'Daiwa Roynet Numazu', dates: '10/31 - 11/2' },
                                { name: 'Onyado Nono Matsumoto', dates: '11/2 - 11/3' },
                                { name: '湯宿 季之庭 (草津)', dates: '11/3 - 11/4', note: '1st Wedding Anniversary' },
                                { name: 'HOTEL CLAD (御殿場)', dates: '11/4 - 11/5' },
                                { name: '淺草東武酒店', dates: '11/5 - 11/8' }
                            ],
                            alarms: [
                                { date: '即刻', task: '買機票' },
                                { date: '4/25', task: '搶訂 季之庭 & HOTEL CLAD' },
                                { date: '7/01', task: '預約租車' },
                                { date: '9/01', task: '搶 Mantensushi' },
                                { date: '9/30', task: '預約 鳥貴族' }
                            ],

                            shopping: ['飛驒牛味噌', '清酒', '紅葉手信'],
                            expenses: [],
                            
                            // 完整行程 Day 1 - Day 9
                            days: [
                                { weekday: 'Sat', dateStr: '10/31', events: [
                                    { time: '06:40', title: '抵達 NRT', desc: '取車出發去沼津', category: 'flight', loc: 'Narita Airport', transportType: 'flight' },
                                    { time: '08:00', title: '出發沼津', desc: '自駕', category: 'transport', loc: 'Numazu', transportType: 'car', travelTime: '3 hr (180km)' },
                                    { time: '11:30', title: '沼津港 (丸天)', desc: 'MC: 650 583 339*01 (魚市場立體停車場)', category: 'food', loc: 'Numazu Port', transportType: 'car', travelTime: '15 min' },
                                    { time: '13:30', title: '三島大吊橋', desc: 'MC: 50 238 668*85 (日本最長吊橋)', category: 'sightseeing', loc: 'Mishima Skywalk', transportType: 'car', travelTime: '30 min' },
                                    { time: '16:00', title: 'Sawayaka 攞飛', desc: '沼津學園通店 (MC: 50 104 702*76) 必做!', category: 'other', loc: 'Sawayaka Numazu', transportType: 'car', travelTime: '20 min' },
                                    { time: '17:00', title: 'Check-in 酒店', desc: 'Daiwa Roynet (泊 Plaza Verde: 50 073 112*71)', category: 'hotel', loc: 'Daiwa Roynet Numazu', transportType: 'car', travelTime: '10 min' },
                                    { time: '19:00', title: 'Dinner: Sawayaka', desc: '必食拳頭漢堡', category: 'food', loc: 'Sawayaka Numazu', transportType: 'walk', travelTime: '15 min' },
                                    { time: '21:00', title: '返酒店休息', desc: 'Plaza Verde 停車場', category: 'hotel', loc: 'Daiwa Roynet Numazu', transportType: 'walk' }
                                ]},
                                { weekday: 'Sun', dateStr: '11/01', events: [
                                    { time: '10:30', title: '大室山', desc: 'MC: 48 846 512*63 (搭吊車)', category: 'sightseeing', loc: 'Omuro Mountain', transportType: 'car', travelTime: '60 min (40km)' },
                                    { time: '12:30', title: 'Lunch: 蕎麥麵', desc: '伊豆高原附近', category: 'food', loc: 'Izu Kogen', transportType: 'car', travelTime: '10 min' },
                                    { time: '14:30', title: '修善寺溫泉', desc: 'MC: 16 186 084*42 (竹林小徑)', category: 'sightseeing', loc: 'Shuzenji', transportType: 'car', travelTime: '45 min' },
                                    { time: '19:00', title: '鰻魚飯 櫻家', desc: '三島市內 (055-975-4520)', category: 'food', loc: 'Sakuraya', transportType: 'car', travelTime: '30 min' },
                                    { time: '20:30', title: '返酒店休息', desc: 'Daiwa Roynet Hotel', category: 'hotel', loc: 'Daiwa Roynet Numazu', transportType: 'car', travelTime: '20 min' }
                                ]},
                                { weekday: 'Mon', dateStr: '11/02', events: [
                                    { time: '11:00', title: '諏訪湖', desc: '立石公園 (MC: 75 236 391*70)', category: 'sightseeing', loc: 'Tateishi Park', transportType: 'car', travelTime: '2.5 hr (160km)' },
                                    { time: '13:00', title: 'Lunch: 山賊燒', desc: '松本市內', category: 'food', loc: 'Matsumoto', transportType: 'car', travelTime: '40 min' },
                                    { time: '14:30', title: '松本城', desc: 'MC: 75 851 375*66', category: 'sightseeing', loc: 'Matsumoto Castle', transportType: 'car', travelTime: '10 min' },
                                    { time: '18:30', title: 'Dinner: 馬肉刺身', desc: '市內居酒屋', category: 'food', loc: 'Matsumoto Station', transportType: 'walk' },
                                    { time: '21:00', title: 'Check-in 松本', desc: 'Onyado Nono (MC: 75 791 881*76)', category: 'hotel', loc: 'Onyado Nono Matsumoto', transportType: 'walk' }
                                ]},
                                { weekday: 'Tue', dateStr: '11/03', events: [
                                    { time: '09:30', title: '善光寺', desc: '第1停車場', category: 'sightseeing', loc: 'Zenkoji', transportType: 'car', travelTime: '1 hr (65km)' },
                                    { time: '12:00', title: 'Enza Cafe', desc: '地獄谷入口 (MC: 341 818 200*82)', category: 'food', loc: 'Enza Cafe', transportType: 'car', travelTime: '45 min' },
                                    { time: '13:00', title: '地獄谷野猿公苑', desc: '行30分鐘睇馬騮', category: 'sightseeing', loc: 'Snow Monkey Park', transportType: 'walk', travelTime: '30 min' },
                                    { time: '16:30', title: 'Check-in 季之庭', desc: 'MC: 341 448 004*52 (1周年紀念)', category: 'highlight', loc: 'Tokinoniwa', transportType: 'car', travelTime: '1 hr (40km)' }
                                ]},
                                { weekday: 'Wed', dateStr: '11/04', events: [
                                    { time: '13:00', title: '河口湖', desc: '大石公園 (MC: 161 303 446*52)', category: 'sightseeing', loc: 'Oishi Park', transportType: 'car', travelTime: '2.5 hr (140km)' },
                                    { time: '14:30', title: '紅葉迴廊', desc: 'MC: 161 361 561*66', category: 'sightseeing', loc: 'Momiji Corridor', transportType: 'car', travelTime: '15 min' },
                                    { time: '16:30', title: 'Check-in', desc: 'HOTEL CLAD (MC: 50 806 191*75)', category: 'hotel', loc: 'HOTEL CLAD', transportType: 'car', travelTime: '45 min (30km)' }
                                ]},
                                { weekday: 'Thu', dateStr: '11/05', events: [
                                    { time: '06:30', title: '山中湖逆富士', desc: '長池親水公園 (MC: 434 324 577*85)', category: 'sightseeing', loc: 'Nagaike Water Park', transportType: 'car', travelTime: '30 min' },
                                    { time: '10:00', title: '御殿場 Outlet', desc: 'Shopping', category: 'shopping', loc: 'Gotemba Outlet', transportType: 'car', travelTime: '40 min' },
                                    { time: '14:00', title: '箱根神社', desc: '平和之鳥居 (MC: 57 123 048*31)', category: 'sightseeing', loc: 'Hakone Shrine', transportType: 'car', travelTime: '40 min' },
                                    { time: '18:00', title: '東京還車', desc: '淺草/上野 (入滿油)', category: 'transport', loc: 'Asakusa', transportType: 'car', travelTime: '2 hr (90km)' },
                                    { time: '19:30', title: 'Dinner: 鳥貴族', desc: '淺草店 Mega Beer', category: 'food', loc: 'Torikizoku Asakusa', transportType: 'walk' },
                                    { time: '21:30', title: '返酒店休息', desc: '淺草東武酒店', category: 'hotel', loc: 'Asakusa Tobu Hotel', transportType: 'walk' }
                                ]},
                                { weekday: 'Fri', dateStr: '11/06', events: [
                                    { time: '10:00', title: '銀座 / 澀谷 Sky', desc: 'Shopping', category: 'shopping', loc: 'Ginza', transportType: 'train', travelTime: '20 min' },
                                    { time: '16:30', title: '東京鐵塔', desc: '停車場打卡位', category: 'sightseeing', loc: 'Tokyo Tower', transportType: 'train', travelTime: '30 min' },
                                    { time: '19:00', title: 'Mantensushi', desc: '10+1 紀念 Omakase', category: 'highlight', loc: 'Mantensushi Nihonbashi', transportType: 'train' },
                                    { time: '21:30', title: '返酒店休息', desc: '淺草東武酒店', category: 'hotel', loc: 'Asakusa Tobu Hotel', transportType: 'train' }
                                ]},
                                { weekday: 'Sat', dateStr: '11/07', events: [
                                    { time: '10:30', title: '吉祥寺', desc: 'Satou 炸牛丸 / 井之頭公園', category: 'sightseeing', loc: 'Kichijoji', transportType: 'train', travelTime: '45 min' },
                                    { time: '14:00', title: '下北澤', desc: '古著店', category: 'shopping', loc: 'Shimokitazawa', transportType: 'train', travelTime: '20 min' },
                                    { time: '19:00', title: 'Dinner', desc: '隨心食', category: 'food', loc: 'Shinjuku', transportType: 'train' },
                                    { time: '21:30', title: '返酒店休息', desc: '淺草東武酒店', category: 'hotel', loc: 'Asakusa Tobu Hotel', transportType: 'train' }
                                ]},
                                { weekday: 'Sun', dateStr: '11/08', events: [
                                    { time: '10:00', title: '最後衝刺', desc: '淺草/上野', category: 'shopping', loc: 'Ueno', transportType: 'walk' },
                                    { time: '14:00', title: 'Skyliner', desc: '上野 -> 成田', category: 'transport', loc: 'Keisei Ueno', transportType: 'train', travelTime: '45 min' },
                                    { time: '18:00', title: '回程 (CX505)', desc: '18:00 起飛', category: 'flight', loc: 'Narita Airport' }
                                ]}
                            ]
                        }
                    },
                    
                    tabs: [
                        { id: 'itinerary', name: '行程', icon: 'fa-solid fa-location-dot' },
                        { id: 'info', name: '資訊', icon: 'fa-solid fa-circle-info' },
                        { id: 'shopping', name: '購物', icon: 'fa-solid fa-bag-shopping' },
                        { id: 'expenses', name: '記帳', icon: 'fa-solid fa-wallet' },
                    ]
                }
            },
            computed: {
                activeTrip() {
                    return this.trips[this.selectedTripId];
                },
                currentTheme() {
                    return this.themes[this.activeTrip.theme];
                },
                currentEffect() {
                    return this.activeTrip.effect;
                },
                currentDayEvents() {
                    return this.activeTrip.days[this.selectedDayIndex].events || [];
                },
                effectIcon() {
                    if (this.currentEffect === 'flower') return 'fa-solid fa-fan'; 
                    if (this.currentEffect === 'leaf') return 'fa-brands fa-canadian-maple-leaf'; 
                    return '';
                },
                totalExpenses() {
                    return this.activeTrip.expenses.reduce((sum, item) => sum + parseInt(item.amount || 0), 0);
                }
            },
            watch: {
                selectedDayIndex() {
                    this.fetchWeather();
                },
                selectedTripId() {
                    this.fetchWeather();
                    this.selectedDayIndex = 0; // Reset day when switching trip
                    this.settings.themeColor = this.activeTrip.theme;
                }
            },
            mounted() {
                this.fetchWeather();
            },
            methods: {
                selectTrip(id) {
                    this.selectedTripId = id;
                    this.currentView = 'detail';
                    this.activeTab = 'itinerary';
                    // Auto set theme color based on trip
                    this.settings.themeColor = this.trips[id].theme;
                },
                changeTheme(color) {
                     this.settings.themeColor = color;
                },
                fetchWeather() {
                    let query = this.activeTrip.weatherCity;
                    fetch(`https://api.openweathermap.org/data/2.5/weather?q=${query}&units=metric&lang=zh_tw&appid=${this.apiKey}`)
                    .then(res => res.json())
                    .then(data => {
                        this.weather.city_name = data.name;
                        this.weather.temp = Math.round(data.main.temp);
                        this.weather.feels_like = Math.round(data.main.feels_like);
                        this.weather.icon = 'fa-sun'; // Default icon
                    })
                    .catch(() => { this.weather.temp = '--'; });
                },
                getCountdown(dateString) {
                    const target = new Date(dateString);
                    const now = new Date();
                    const diff = target - now;
                    return Math.ceil(diff / (1000 * 60 * 60 * 24));
                },
                itemCategoryName(cat) {
                    const map = { sightseeing: '景點', food: '美食', shopping: '購物', transport: '交通', hotel: '住宿', flight: '航班', ticket: '門票', highlight: '紀念日' };
                    return map[cat] || '其他';
                },
                getTransportIcon(type) {
                    const map = { walk: 'fa-person-walking', train: 'fa-train-subway', car: 'fa-car', bus: 'fa-bus', flight: 'fa-plane' };
                    return `fa-solid ${map[type] || 'fa-arrow-right'}`;
                },
                openMap(location) {
                    if (location) {
                        window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location)}`, '_blank');
                    }
                },
                addShoppingItem() { if(this.newShopItem) this.activeTrip.shopping.push(this.newShopItem); this.newShopItem = ''; },
                removeShoppingItem(idx) { this.activeTrip.shopping.splice(idx, 1); },
                deleteExpense(idx) { this.activeTrip.expenses.splice(idx, 1); },
                
                openAddModal() { this.showModal = true; },
                confirmAdd() { 
                    if(this.newItem.title && this.currentView === 'detail') {
                        this.activeTrip.days[this.selectedDayIndex].events.push({...this.newItem});
                    }
                    this.showModal = false; 
                },
                tabClass(tab) {
                    const color = this.currentTheme.main;
                    return this.activeTab === tab 
                        ? `bg-[${color}] text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center transform scale-110 transition-all` 
                        : `bg-white/90 text-[${color}] w-10 h-10 rounded-full shadow flex items-center justify-center hover:bg-white transition-all`;
                },
                convert(type) {
                    if (type === 'jpy') this.calcHkd = (this.calcJpy * this.exchangeRate).toFixed(2);
                    else this.calcJpy = (this.calcHkd / this.exchangeRate).toFixed(0);
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
