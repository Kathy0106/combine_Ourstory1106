<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÊàëÁöÑÊóÖÈÅäÊâãÂ∏≥ V44</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: #FFF9F5;
            overscroll-behavior-y: none;
            -webkit-tap-highlight-color: transparent;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .soft-shadow { box-shadow: 0 8px 30px rgba(0,0,0,0.08); }
        .card-press:active { transform: scale(0.98); transition: transform 0.1s; }
        
        /* È£ÑËêΩÂãïÁï´ */
        @keyframes fall {
            0% { transform: translateY(-10vh) translateX(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(110vh) translateX(20px) rotate(360deg); opacity: 0; }
        }
        .falling-item {
            position: fixed;
            top: -10%;
            user-select: none;
            pointer-events: none;
            z-index: 0;
            animation-name: fall;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
        }
        
        /* Header Transition */
        .header-bg {
            transition: background-image 0.5s ease-in-out;
        }
    </style>
</head>
<body class="h-screen w-screen overflow-hidden text-slate-700">

    <div id="app" class="h-full flex flex-col relative transition-colors duration-700" :style="{ backgroundColor: currentTheme.bg }">

        <div v-if="currentEffect !== 'none'" class="absolute inset-0 overflow-hidden pointer-events-none z-0">
            <div v-for="n in 15" :key="n" class="falling-item text-xl opacity-60" 
                 :style="{ 
                    left: Math.random() * 100 + 'vw', 
                    animationDuration: (Math.random() * 5 + 5) + 's', 
                    animationDelay: (Math.random() * 5) + 's',
                    color: currentTheme.main
                 }">
                <i :class="effectIcon"></i>
            </div>
        </div>

        <div v-if="currentView === 'home'" class="flex-1 flex flex-col p-6 z-10 overflow-y-auto">
            
            <div class="flex justify-between items-center mb-8 mt-4">
                <div>
                    <h1 class="text-3xl font-bold text-slate-800">ÊàëÁöÑÊóÖÁ®ã</h1>
                    <p class="text-sm text-gray-400 mt-1">Ready for the next adventure? ‚úàÔ∏è</p>
                </div>
                <div class="w-12 h-12 rounded-full bg-white soft-shadow flex items-center justify-center overflow-hidden border-2 border-white">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Kathy" alt="User">
                </div>
            </div>

            <div class="space-y-6">
                
                <div @click="selectTrip('karuizawa')" class="bg-white rounded-[30px] p-0 soft-shadow overflow-hidden card-press cursor-pointer group relative">
                    <div class="h-32 bg-cover bg-center relative" :style="{ backgroundImage: `url(${trips.karuizawa.headerImg})` }">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
                        <div class="absolute bottom-3 left-4 text-white">
                            <h3 class="text-xl font-bold">{{ trips.karuizawa.name }}</h3>
                            <p class="text-xs opacity-90"><i class="fa-solid fa-location-dot mr-1"></i>Êù±‰∫¨„ÄÅËºï‰∫ïÊæ§</p>
                        </div>
                    </div>
                    <div class="p-4 flex justify-between items-center">
                        <div>
                            <div class="text-xs text-gray-400 mb-1">Ë∑ùÈõ¢Âá∫Áôº</div>
                            <div class="text-2xl font-bold text-pink-500 font-mono">{{ getCountdown('2026-04-18') }} <span class="text-xs text-gray-400 font-sans">Â§©</span></div>
                        </div>
                        <div class="w-10 h-10 rounded-full bg-pink-50 text-pink-500 flex items-center justify-center">
                            <i class="fa-solid fa-chevron-right"></i>
                        </div>
                    </div>
                </div>

                <div @click="selectTrip('central')" class="bg-white rounded-[30px] p-0 soft-shadow overflow-hidden card-press cursor-pointer group relative">
                    <div class="h-32 bg-cover bg-center relative" :style="{ backgroundImage: `url(${trips.central.headerImg})` }">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
                        <div class="absolute bottom-3 left-4 text-white">
                            <h3 class="text-xl font-bold">{{ trips.central.name }}</h3>
                            <p class="text-xs opacity-90"><i class="fa-solid fa-location-dot mr-1"></i>ÂêçÂè§Â±ã„ÄÅÈ´òÂ±±</p>
                        </div>
                    </div>
                    <div class="p-4 flex justify-between items-center">
                        <div>
                            <div class="text-xs text-gray-400 mb-1">Ë∑ùÈõ¢Âá∫Áôº</div>
                            <div class="text-2xl font-bold text-orange-500 font-mono">{{ getCountdown('2026-10-31') }} <span class="text-xs text-gray-400 font-sans">Â§©</span></div>
                        </div>
                        <div class="w-10 h-10 rounded-full bg-orange-50 text-orange-500 flex items-center justify-center">
                            <i class="fa-solid fa-chevron-right"></i>
                        </div>
                    </div>
                </div>

                 <div class="border-2 border-dashed border-gray-300 rounded-[30px] p-6 flex flex-col items-center justify-center text-gray-400 card-press cursor-pointer opacity-50">
                    <i class="fa-solid fa-plus text-2xl mb-2"></i>
                    <span class="text-sm">Êñ∞Â¢ûÊóÖÁ®ã</span>
                </div>
            </div>
        </div>


        <div v-if="currentView === 'detail'" class="flex-1 flex flex-col relative z-10 h-full">
            
            <div class="relative h-48 header-bg bg-cover bg-center" :style="{ backgroundImage: `url(${activeTrip.headerImg})` }">
                <div class="absolute inset-0 bg-gradient-to-b from-black/30 to-black/60"></div>
                
                <div class="absolute top-0 w-full px-4 py-3 flex justify-between items-center z-50">
                    <button @click="currentView = 'home'" class="w-10 h-10 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center text-white hover:bg-white/30 transition-colors">
                        <i class="fa-solid fa-arrow-left"></i>
                    </button>
                    <button @click="showSettings = true" class="w-10 h-10 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center text-white hover:bg-white/30 transition-colors">
                        <i class="fa-solid fa-gear"></i>
                    </button>
                </div>

                <div class="absolute bottom-4 left-6 text-white text-shadow">
                    <h2 class="text-2xl font-bold tracking-wider mb-1">{{ activeTrip.name }}</h2>
                    <p class="text-xs opacity-90 font-mono bg-black/20 px-2 py-1 rounded inline-block">{{ activeTrip.range }}</p>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto no-scrollbar p-5 pb-24 -mt-6 bg-transparent z-10">
                
                <div v-if="activeTab === 'itinerary'">
                    
                    <div class="flex space-x-3 overflow-x-auto no-scrollbar mb-6 py-2">
                        <div v-for="(day, index) in activeTrip.days" :key="index" 
                             @click="selectedDayIndex = index"
                             class="flex-shrink-0 flex flex-col items-center justify-center w-16 h-20 rounded-2xl transition-all duration-300 snap-center cursor-pointer border border-white/50 soft-shadow"
                             :class="selectedDayIndex === index ? 'text-white shadow-lg scale-105' : 'bg-white text-gray-400'"
                             :style="{ backgroundColor: selectedDayIndex === index ? currentTheme.main : 'white' }">
                            <span class="text-xs font-bold uppercase">{{ day.weekday }}</span>
                            <span class="text-xl font-bold">{{ day.dateStr }}</span>
                            <span class="text-[10px] opacity-80">Day {{ index + 1 }}</span>
                        </div>
                    </div>

                    <div class="bg-gradient-to-r from-white to-gray-50 rounded-2xl p-4 mb-6 flex items-center justify-between shadow-sm text-slate-600 border border-gray-100">
                        <div>
                            <div class="text-xs opacity-70 flex items-center gap-1">
                                <i class="fa-solid fa-location-dot" :style="{ color: currentTheme.main }"></i> {{ weather.city_name }}
                            </div>
                            <div class="text-2xl font-bold">{{ weather.temp }}¬∞C <span class="text-sm font-normal text-gray-500">È´îÊÑü {{ weather.feels_like }}¬∞C</span></div>
                        </div>
                        <i :class="['fa-solid', weather.icon, 'text-4xl drop-shadow-sm']" :style="{ color: currentTheme.main }"></i>
                    </div>

                    <div class="space-y-4 relative">
                        <div class="absolute left-[19px] top-4 bottom-0 w-0.5 bg-gray-200 z-0"></div>
                        
                        <div v-for="(item, i) in currentDayEvents" :key="i" class="ml-12 mb-3 bg-white rounded-2xl p-4 soft-shadow border-l-4 group relative transition-transform active:scale-95" :style="{ borderLeftColor: currentTheme.main }">
                            <div class="flex justify-between items-start mb-1">
                                <span class="text-xs font-bold px-2 py-0.5 rounded text-white" :style="{ backgroundColor: currentTheme.main }">{{ item.time }}</span>
                                <div class="flex gap-2">
                                    <button @click.stop="openMap(item.location)" class="text-gray-300 hover:text-blue-500"><i class="fa-solid fa-location-arrow"></i></button>
                                </div>
                            </div>
                            <h4 class="font-bold text-slate-800 text-lg mb-1">{{ item.title }}</h4>
                            <p class="text-sm text-gray-500 flex items-start gap-1">
                                <i class="fa-regular fa-note-sticky mt-1 text-xs opacity-50"></i>
                                <span class="whitespace-pre-line">{{ item.desc }}</span>
                            </p>
                            
                            <div class="flex flex-wrap gap-2 mt-3">
                                <span v-if="item.category" class="text-[10px] px-2 py-1 rounded-md bg-gray-100 text-gray-500">
                                    {{ itemCategoryName(item.category) }}
                                </span>
                                <span v-if="item.transportType" class="text-[10px] px-2 py-1 rounded-md bg-blue-50 text-blue-500">
                                    <i :class="getTransportIcon(item.transportType)"></i> {{ item.travelTime || 'ÁßªÂãï' }}
                                </span>
                            </div>
                        </div>

                        <div v-if="currentDayEvents.length === 0" class="ml-12 py-10 text-gray-400 text-sm">
                            Êú¨Êó•Êö´ÁÑ°Ë°åÁ®ãÔºåÈªûÊìäÂè≥‰∏ãËßíÊñ∞Â¢û
                        </div>
                    </div>
                </div>

                <div v-if="activeTab === 'info'" class="space-y-6">
                    
                    <div class="bg-white rounded-2xl p-0 soft-shadow overflow-hidden border-l-4" :style="{ borderLeftColor: currentTheme.main }">
                        <div class="bg-gray-50 p-3 font-bold flex justify-between items-center" :style="{ color: currentTheme.main }">
                            <span><i class="fa-solid fa-file-lines mr-2"></i>Ë©≥Á¥∞ Google Doc Ë°åÁ®ã</span>
                        </div>
                        <div class="p-4">
                            <a :href="activeTrip.docLink" target="_blank" 
                               class="block w-full text-white font-bold py-3 rounded-xl shadow-md transition-transform active:scale-95 text-center"
                               :style="{ backgroundColor: currentTheme.main }">
                                <i class="fa-brands fa-google-drive mr-2"></i> ÈªûÊìäÊü•ÁúãÂÆåÊï¥ÊñáÊ™î
                            </a>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl p-0 soft-shadow overflow-hidden border-2 border-red-100">
                        <div class="bg-red-50 p-3 text-red-600 font-bold flex justify-between items-center">
                            <span><i class="fa-regular fa-bell mr-2"></i>ÈóúÈçµË°åÂãïÈ¨ßÈêò</span>
                        </div>
                        <div class="p-4 space-y-3 text-xs">
                            <div v-for="(alarm, idx) in activeTrip.alarms" :key="idx" class="flex gap-2 border-b border-gray-50 pb-2 last:border-0 last:pb-0">
                                <span class="font-bold w-12 text-red-500">{{ alarm.date }}</span> 
                                <span>{{ alarm.task }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl p-0 soft-shadow overflow-hidden">
                        <div class="p-3 text-white font-bold flex justify-between" :style="{ backgroundColor: currentTheme.main }">
                            <span><i class="fa-solid fa-plane mr-2"></i>Ëà™Áè≠Ë≥áË®ä</span>
                        </div>
                        <div class="p-5">
                            <div class="mb-4">
                                <div class="flex justify-between text-xs text-gray-400 mb-1"><span>ÂéªÁ®ã (HKG ‚Üí JP)</span></div>
                                <div class="flex justify-between items-center mb-1">
                                    <div class="text-xl font-bold text-slate-700">{{ activeTrip.flights.out.dep }}</div>
                                    <div class="h-0.5 w-10 bg-gray-200 relative flex justify-center"><i class="fa-solid fa-plane text-gray-400 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"></i></div>
                                    <div class="text-xl font-bold text-slate-700">{{ activeTrip.flights.out.arr }}</div>
                                </div>
                                <div class="flex justify-between text-sm font-bold bg-gray-50 p-2 rounded-lg">
                                    <span>{{ activeTrip.flights.out.code }}</span>
                                    <span>{{ activeTrip.flights.out.date }}</span>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-xs text-gray-400 mb-1"><span>ÂõûÁ®ã (JP ‚Üí HKG)</span></div>
                                <div class="flex justify-between items-center mb-1">
                                    <div class="text-xl font-bold text-slate-700">{{ activeTrip.flights.in.dep }}</div>
                                    <div class="h-0.5 w-10 bg-gray-200 relative flex justify-center"><i class="fa-solid fa-plane text-gray-400 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"></i></div>
                                    <div class="text-xl font-bold text-slate-700">{{ activeTrip.flights.in.arr }}</div>
                                </div>
                                <div class="flex justify-between text-sm font-bold bg-gray-50 p-2 rounded-lg">
                                    <span>{{ activeTrip.flights.in.code }}</span>
                                    <span>{{ activeTrip.flights.in.date }}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <h3 class="font-bold text-gray-500 ml-1">‰ΩèÂÆøÂàóË°®</h3>
                        <div v-for="hotel in activeTrip.hotels" :key="hotel.name" class="bg-white rounded-2xl p-4 soft-shadow flex items-center gap-4" @click="openMap(hotel.name)">
                            <div class="w-12 h-12 rounded-full flex items-center justify-center text-white text-xl" :style="{ backgroundColor: currentTheme.main }">
                                <i class="fa-solid fa-bed"></i>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-bold text-sm">{{ hotel.name }}</h4>
                                <p class="text-xs text-gray-400 mt-1">{{ hotel.dates }}</p>
                                <p v-if="hotel.note" class="text-[10px] text-red-400 mt-1"><i class="fa-solid fa-gift mr-1"></i>{{ hotel.note }}</p>
                            </div>
                            <i class="fa-solid fa-chevron-right text-gray-300"></i>
                        </div>
                    </div>
                </div>

                <div v-if="activeTab === 'shopping'">
                    <div class="bg-white rounded-2xl p-4 soft-shadow mb-4">
                        <h3 class="font-bold mb-3">ÂæÖË≥ºÊ∏ÖÂñÆ ({{ activeTrip.shopping.length }})</h3>
                        <div class="space-y-3">
                            <div v-for="(item, idx) in activeTrip.shopping" :key="idx" class="flex items-center gap-3 p-3 bg-white border border-gray-100 rounded-xl shadow-sm">
                                <input type="checkbox" class="w-5 h-5 rounded border-gray-300" :class="`accent-${activeTrip.theme}-500`">
                                <span class="text-sm font-bold">{{ item }}</span>
                                <button @click="removeShoppingItem(idx)" class="ml-auto text-gray-300 hover:text-red-400"><i class="fa-solid fa-trash"></i></button>
                            </div>
                            <div class="flex gap-2 mt-4">
                                <input v-model="newShopItem" placeholder="Êñ∞Â¢ûÁâ©ÂìÅ..." class="flex-1 bg-gray-100 p-3 rounded-xl text-sm outline-none">
                                <button @click="addShoppingItem" class="w-12 h-12 rounded-xl text-white flex items-center justify-center shadow-md transition-transform active:scale-95" :style="{ backgroundColor: currentTheme.main }"><i class="fa-solid fa-plus"></i></button>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-if="activeTab === 'expenses'">
                    <div class="bg-white rounded-3xl p-6 soft-shadow mb-6 text-center">
                        <p class="text-xs text-gray-400 mb-1">Á∏ΩËä±Ë≤ª (HKD)</p>
                        <div class="text-4xl font-bold text-slate-800">${{ totalExpenses.toLocaleString() }}</div>
                    </div>
                    <div class="bg-white rounded-2xl p-4 soft-shadow">
                        <div v-for="(exp, idx) in activeTrip.expenses" :key="idx" class="flex justify-between items-center py-3 border-b border-gray-100 last:border-0">
                            <div>
                                <div class="font-bold text-sm">{{ exp.item }}</div>
                                <div class="text-xs text-gray-400">{{ exp.date }} ‚Ä¢ {{ exp.cat }}</div>
                            </div>
                            <div class="flex items-center gap-3">
                                <div class="font-bold" :style="{ color: currentTheme.main }">${{ exp.amount }}</div>
                                <button @click="deleteExpense(idx)" class="text-gray-300 text-xs"><i class="fa-solid fa-trash"></i></button>
                            </div>
                        </div>
                        <div v-if="activeTrip.expenses.length === 0" class="text-center text-gray-400 py-4 text-sm">Êö´ÁÑ°Á¥ÄÈåÑ</div>
                    </div>
                    <button class="w-full mt-4 py-3 rounded-xl text-white font-bold shadow-md transition-transform active:scale-95" :style="{ backgroundColor: currentTheme.main }">Ë®ò‰∏ÄÁ≠Ü</button>
                </div>

            </div>

            <div class="bg-white absolute bottom-0 w-full px-6 py-4 rounded-t-[30px] shadow-[0_-5px_30px_rgba(0,0,0,0.05)] flex justify-between items-center z-50">
                <button v-for="tab in tabs" :key="tab.id" 
                    @click="activeTab = tab.id"
                    class="flex flex-col items-center gap-1 transition-all duration-300"
                    :class="activeTab === tab.id ? 'transform -translate-y-2' : 'opacity-50'">
                    <div class="w-12 h-12 rounded-full flex items-center justify-center text-xl transition-all shadow-sm"
                         :style="{ 
                             backgroundColor: activeTab === tab.id ? currentTheme.main : 'transparent', 
                             color: activeTab === tab.id ? 'white' : '#64748B' 
                         }">
                        <i :class="tab.icon"></i>
                    </div>
                    <span class="text-[10px] font-bold" :class="activeTab === tab.id ? 'text-slate-800' : 'text-transparent'">{{ tab.name }}</span>
                </button>
            </div>
        </div>

        <button v-if="currentView === 'detail' && activeTab === 'itinerary'" @click="openAddModal" class="absolute bottom-24 right-6 w-14 h-14 rounded-full shadow-lg flex items-center justify-center text-2xl z-50 text-white transition-transform active:scale-90" :style="{ backgroundColor: currentTheme.main }">
            <i class="fa-solid fa-plus"></i>
        </button>

        <div v-if="showModal" class="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/50 backdrop-blur-sm" @click.self="showModal = false">
            <div class="bg-white w-full sm:w-96 rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl animate-slide-up">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold" :style="{ color: currentTheme.main }">Êñ∞Â¢ûÈ†ÖÁõÆ</h3>
                    <button @click="showModal = false" class="text-gray-400"><i class="fa-solid fa-xmark text-xl"></i></button>
                </div>

                <div class="space-y-4">
                    <input v-model="newItem.title" type="text" placeholder="Ê®ôÈ°å / È†ÖÁõÆÂêçÁ®±" class="w-full p-3 bg-gray-50 rounded-xl border-none outline-none">
                    <div class="flex gap-2">
                        <input v-model="newItem.time" type="time" class="w-1/3 p-3 bg-gray-50 rounded-xl outline-none">
                        <select v-model="newItem.category" class="w-2/3 p-3 bg-gray-50 rounded-xl outline-none">
                            <option value="sightseeing">ÊôØÈªû</option>
                            <option value="food">ÁæéÈ£ü</option>
                            <option value="shopping">Ë≥ºÁâ©</option>
                        </select>
                    </div>
                </div>

                <button @click="confirmAdd" class="w-full text-white font-bold py-4 rounded-xl mt-6 shadow-lg" :style="{ backgroundColor: currentTheme.main }">Á¢∫Ë™çÊñ∞Â¢û</button>
            </div>
        </div>

    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    currentView: 'home', 
                    selectedTripId: 'karuizawa', 
                    activeTab: 'itinerary',
                    selectedDayIndex: 0,
                    showModal: false,
                    newShopItem: '',
                    
                    weather: { city_name: '', temp: '--', feels_like: '--', icon: 'fa-spinner fa-spin' },
                    apiKey: 'cc2dab2806da14aec6dab2ed8260a1c4',

                    themes: {
                        pink: { main: '#FB7185', bg: '#FFF0F3' },   // Ê´ªËä±Á≤â
                        orange: { main: '#F97316', bg: '#FFF7ED' }  // Á¥ÖËëâÊ©ô
                    },

                    // ÂÆåÊï¥Ë°åÁ®ãË≥áÊñôÊï¥Âêà
                    trips: {
                        karuizawa: {
                            id: 'karuizawa',
                            name: 'üå∏ Ëºï‰∫ïÊæ§ Pre-wedding',
                            date: '2026-04-18',
                            range: 'Apr 18 - 25, 2026',
                            theme: 'pink',
                            effect: 'flower',
                            headerImg: 'https://images.unsplash.com/photo-1522383225653-ed111181a951?auto=format&fit=crop&w=800&q=80',
                            docLink: 'https://docs.google.com/document/d/1-4mgjTycE9bGWhuitIkigPSM4_0fBPlZX2RoVRCTlXw/edit?usp=drivesdk',
                            weatherCity: 'Karuizawa,JP',
                            
                            // Info Tab Êï∏Êìö
                            flights: {
                                out: { code: 'CX524', date: '4/18', dep: '01:00', arr: '06:40' },
                                in: { code: 'CX501', date: '4/25', dep: '21:30', arr: '02:00' }
                            },
                            hotels: [
                                { name: 'VIA INN PRIME Êó•Êú¨Ê©ã‰∫∫ÂΩ¢Áî∫', dates: '4/18 - 4/20' },
                                { name: 'Toyoko Inn ‰Ωê‰πÖÂπ≥Á´ôÊ∑∫ÈñìÂè£', dates: '4/20 - 4/22' },
                                { name: 'ÂÖ´ÈáçÁø†Êù±‰∫¨ÈÖíÂ∫ó', dates: '4/22 - 4/25' }
                            ],
                            alarms: [
                                { date: 'Âç≥Âàª', task: 'Ë≤∑Ê©üÁ•®' },
                                { date: '1/20', task: 'Book Ëºï‰∫ïÊæ§ÁáíËÇâ' },
                                { date: '3/23', task: 'Êê∂ Disney Pass' }
                            ],

                            shopping: ['‰øùÊöñË•™', 'Èö±ÂΩ¢ÁúºÈè°', 'Head dress', 'NuBra'],
                            expenses: [],
                            
                            // ÂÆåÊï¥Ë°åÁ®ã Day 1 - Day 8
                            days: [
                                { weekday: 'Sat', dateStr: '4/18', events: [
                                    { time: '06:40', title: 'ÊäµÈÅîÊàêÁî∞ (NRT)', desc: 'Ë≤∑È£õÂéª T-CAT', category: 'flight', loc: 'Narita Airport' },
                                    { time: '09:00', title: 'Check-in ÈÖíÂ∫ó', desc: 'VIA INN PRIME Êó•Êú¨Ê©ã‰∫∫ÂΩ¢Áî∫', category: 'hotel', loc: 'Ningyocho' },
                                    { time: '11:00', title: 'Âà©‰πÖÁâõËàå (ÂçàÈ§ê)', desc: '‰∏äÈáé Parco_ya 6F', category: 'food', loc: 'Rikyu Ueno' },
                                    { time: '13:00', title: 'Ê†πÊ¥•Á•ûÁ§æ', desc: 'ÊùúÈµëËä±Á•≠', category: 'sightseeing', loc: 'Nezu Shrine' },
                                    { time: '17:00', title: 'Á±≥‰πÖÊú¨Â∫ó', desc: 'ÁôæÂπ¥ÁâõÈçã (Â£ΩÂñúÁáí)', category: 'food', loc: 'Asakusa' }
                                ]},
                                { weekday: 'Sun', dateStr: '4/19', events: [
                                    { time: '09:30', title: 'ÈæúÊà∂Â§©Á•ûÁ§æ', desc: 'Á¥´Ëó§Ëä±', category: 'sightseeing', loc: 'Kameido Tenjin' },
                                    { time: '12:30', title: 'Â±±Á¨ë„Åµ', desc: 'Shabu Shabu (Â∑≤È†êÁ¥Ñ)', category: 'food', loc: 'Omotesando' },
                                    { time: '14:30', title: 'Harakado', desc: 'Â±ãÈ†ÇËä±Âúí', category: 'sightseeing', loc: 'Harakado' },
                                    { time: '19:00', title: 'Áâõ„Åã„Å§„ÇÇ„Å®Êùë', desc: 'ÁÇ∏ÁâõÊéí (ÊæÄË∞∑)', category: 'food', loc: 'Shibuya' }
                                ]},
                                { weekday: 'Mon', dateStr: '4/20', events: [
                                    { time: '09:00', title: 'Check-out', desc: 'Ë°åÂéª T-CAT', category: 'other', loc: 'T-CAT' },
                                    { time: '09:30', title: 'ÂèñËªä', desc: 'Toyota Rent a Car (98147748300)', category: 'transport', loc: 'T-CAT' },
                                    { time: '10:30', title: '‰∏âËä≥ PA', desc: '‰ºëÊÅØÁ´ô', category: 'transport', loc: 'Miyoshi PA' },
                                    { time: '13:00', title: 'Ëºï‰∫ïÊæ§ÂçàÈ§ê', desc: 'Â∑ù‰∏äÂ∫µ Êàñ ÊùëÊ∞ëÈ£üÂ†Ç', category: 'food', loc: 'Karuizawa' },
                                    { time: '14:30', title: 'Outlet Shopping', desc: 'MapCode: 292 677 245*55', category: 'shopping', loc: 'Prince Shopping Plaza' },
                                    { time: '18:00', title: 'Check-in', desc: 'Toyoko Inn ‰Ωê‰πÖÂπ≥', category: 'hotel', loc: 'Saku' }
                                ]},
                                { weekday: 'Tue', dateStr: '4/21', events: [
                                    { time: '08:00', title: 'Pre-wedding', desc: 'ÂÖ®Êó•ÊãçÊîù', category: 'highlight', loc: 'Karuizawa' },
                                    { time: '19:00', title: 'ÊÖ∂ÂäüÊôöÈ§ê', desc: 'Ëºï‰∫ïÊæ§ÁáíËÇâ', category: 'food', loc: 'Rogotei' }
                                ]},
                                { weekday: 'Wed', dateStr: '4/22', events: [
                                    { time: '10:00', title: 'ÁôΩÁµ≤ÁÄëÂ∏É', desc: 'MapCode: 292 701 645*63', category: 'sightseeing', loc: 'Shiraito Falls' },
                                    { time: '11:00', title: 'Rogotei ÁáíËÇâ', desc: 'ÂçàÈ§ê', category: 'food', loc: 'Rogotei Karuizawa' },
                                    { time: '14:00', title: 'Ê©´Â∑ù SA', desc: 'ÈáúÈ£Ø‰æøÁï∂', category: 'food', loc: 'Yokokawa SA' },
                                    { time: '17:00', title: 'Êù±‰∫¨ÈÇÑËªä', desc: 'T-CAT B1 ÂÅúËªäÂ†¥', category: 'transport', loc: 'T-CAT' },
                                    { time: '18:00', title: 'Check-in', desc: 'ÂÖ´ÈáçÁø†Êù±‰∫¨ÈÖíÂ∫ó', category: 'hotel', loc: 'Yaekit' },
                                    { time: '20:45', title: 'Â£ΩÂè∏ÈÉé', desc: 'ÂÖ´ÈáçÊ¥≤Âú∞‰∏ãË°ó', category: 'food', loc: 'Sushiro' }
                                ]},
                                { weekday: 'Thu', dateStr: '4/23', events: [
                                    { time: '06:45', title: 'Âá∫Áôº', desc: 'JR ‰∫¨ËëâÁ∑ö -> ËàûÊø±', category: 'transport', loc: 'Hatchobori' },
                                    { time: '07:30', title: 'Disney Sea', desc: 'Êê∂ Frozen Pass', category: 'ticket', loc: 'Tokyo DisneySea' },
                                    { time: '21:00', title: 'ÂÆµÂ§ú', desc: 'È∫•Áï∂ÂãûÂéöÁâõÂ†°', category: 'food', loc: 'Hatchobori' }
                                ]},
                                { weekday: 'Fri', dateStr: '4/24', events: [
                                    { time: '09:30', title: 'ÂâçÂæÄË±êÊ¥≤', desc: 'ÁöÑÂ£´', category: 'transport', loc: 'Toyosu' },
                                    { time: '10:00', title: 'Â§ßÂíåÂ£ΩÂè∏', desc: 'Êó©È§ê', category: 'food', loc: 'Daiwa Sushi' },
                                    { time: '13:30', title: 'TeamLab', desc: 'Planets', category: 'sightseeing', loc: 'TeamLab Planets' },
                                    { time: '18:30', title: 'ÈäÄÂ∫ß ÁØù', desc: 'ÈõûÁôΩÊπØÊãâÈ∫µ', category: 'food', loc: 'Ginza Kagari' }
                                ]},
                                { weekday: 'Sat', dateStr: '4/25', events: [
                                    { time: '10:30', title: 'Êù±‰∫¨‰∏ÄÁï™Ë°ó', desc: 'ÊúÄÂæåË°ùÂà∫', category: 'shopping', loc: 'Tokyo Station' },
                                    { time: '14:30', title: 'T-CAT', desc: 'ÂØÑË°åÊùé', category: 'transport', loc: 'T-CAT' },
                                    { time: '14:45', title: 'ÂâçÂæÄÊ©üÂ†¥', desc: 'Â∑¥Â£´', category: 'transport', loc: 'Narita Airport' }
                                ]}
                            ]
                        },
                        central: {
                            id: 'central',
                            name: 'üçÅ Êó•Êú¨‰∏≠ÈÉ®Á¥ÖËëâ‰πãÊóÖ',
                            date: '2026-10-31', 
                            range: 'Oct 31 - Nov 08, 2026',
                            theme: 'orange',
                            effect: 'leaf',
                            headerImg: 'https://images.unsplash.com/photo-1478436127897-769e1b3f0f36?auto=format&fit=crop&w=800&q=80',
                            docLink: 'https://docs.google.com/document/d/11eFLaGqOmRfXx90pVCWGF0iNIQRwECa3X3VmFjqQgdk/edit?usp=drivesdk',
                            weatherCity: 'Nagoya,JP',

                            // Info Tab Êï∏Êìö
                            flights: {
                                out: { code: 'CX524', date: '10/31', dep: '01:00', arr: '06:40' },
                                in: { code: 'CX505', date: '11/08', dep: '18:00', arr: '22:25' }
                            },
                            rental: {
                                company: 'Toyota Rent a Car',
                                pickup: '10/31 08:00 @ ÊàêÁî∞Ê©üÂ†¥',
                                return: '11/05 18:00 @ Ê∑∫Ëçâ/‰∏äÈáé',
                                note: 'ÂøÖÈ†àÊåáÂÆöÈõ™ËÉé (Snow Tires)'
                            },
                            hotels: [
                                { name: 'Daiwa Roynet Numazu', dates: '10/31 - 11/2' },
                                { name: 'Onyado Nono Matsumoto', dates: '11/2 - 11/3' },
                                { name: 'ÊπØÂÆø Â≠£‰πãÂ∫≠ (ËçâÊ¥•)', dates: '11/3 - 11/4', note: '1st Wedding Anniversary' },
                                { name: 'HOTEL CLAD (Âæ°ÊÆøÂ†¥)', dates: '11/4 - 11/5' },
                                { name: 'Ê∑∫ËçâÊù±Ê≠¶ÈÖíÂ∫ó', dates: '11/5 - 11/8' }
                            ],
                            alarms: [
                                { date: 'Âç≥Âàª', task: 'Ë≤∑Ê©üÁ•®' },
                                { date: '4/25', task: 'Êê∂Ë®Ç Â≠£‰πãÂ∫≠' },
                                { date: '9/01', task: 'Êê∂ Mantensushi' }
                            ],

                            shopping: ['È£õÈ©íÁâõÂë≥Âôå', 'Ê∏ÖÈÖí', 'Á¥ÖËëâÊâã‰ø°'],
                            expenses: [],
                            
                            // ÂÆåÊï¥Ë°åÁ®ã Day 1 - Day 9
                            days: [
                                { weekday: 'Sat', dateStr: '10/31', events: [
                                    { time: '06:40', title: 'ÊäµÈÅî NRT', desc: 'ÂèñËªäÂá∫ÁôºÂéªÊ≤ºÊ¥•', category: 'flight', loc: 'Narita Airport' },
                                    { time: '11:30', title: 'Ê≤ºÊ¥•Ê∏Ø (‰∏∏Â§©)', desc: 'Êµ∑ÈÆÆ‰∏º', category: 'food', loc: 'Numazu Port' },
                                    { time: '13:30', title: '‰∏âÂ≥∂Â§ßÂêäÊ©ã', desc: 'Êó•Êú¨ÊúÄÈï∑', category: 'sightseeing', loc: 'Mishima Skywalk' },
                                    { time: '19:00', title: 'Sawayaka', desc: 'ÂøÖÈ£üÊº¢Â†°Êâí', category: 'food', loc: 'Numazu' },
                                    { time: '21:00', title: 'Check-in', desc: 'Daiwa Roynet Numazu', category: 'hotel', loc: 'Numazu' }
                                ]},
                                { weekday: 'Sun', dateStr: '11/01', events: [
                                    { time: '10:30', title: 'Â§ßÂÆ§Â±±', desc: 'Êê≠ÂêäËªä', category: 'sightseeing', loc: 'Omuro Mountain' },
                                    { time: '14:30', title: '‰øÆÂñÑÂØ∫Ê∫´Ê≥â', desc: 'Á´πÊûóÂ∞èÂæë', category: 'sightseeing', loc: 'Shuzenji' },
                                    { time: '19:00', title: 'È∞ªÈ≠öÈ£Ø Ê´ªÂÆ∂', desc: '‰∏âÂ≥∂Â∏ÇÂÖß', category: 'food', loc: 'Sakuraya' }
                                ]},
                                { weekday: 'Mon', dateStr: '11/02', events: [
                                    { time: '11:00', title: 'Ë´èË®™Êπñ', desc: 'Á´ãÁü≥ÂÖ¨Âúí (‰Ω†ÁöÑÂêçÂ≠ó)', category: 'sightseeing', loc: 'Suwa Lake' },
                                    { time: '14:30', title: 'ÊùæÊú¨Âüé', desc: 'ÂúãÂØ∂Âüé', category: 'sightseeing', loc: 'Matsumoto Castle' },
                                    { time: '21:00', title: 'Check-in', desc: 'Onyado Nono Matsumoto', category: 'hotel', loc: 'Matsumoto' }
                                ]},
                                { weekday: 'Tue', dateStr: '11/03', events: [
                                    { time: '09:30', title: 'ÂñÑÂÖâÂØ∫', desc: 'Èï∑ÈáéÂêçÂãù', category: 'sightseeing', loc: 'Zenkoji' },
                                    { time: '13:00', title: 'Âú∞ÁçÑË∞∑ÈáéÁåøÂÖ¨Ëãë', desc: 'È¶¨È®ÆÊµ∏Ê∫´Ê≥â', category: 'sightseeing', loc: 'Snow Monkey Park' },
                                    { time: '16:30', title: 'Check-in Â≠£‰πãÂ∫≠', desc: 'ËçâÊ¥•Ê∫´Ê≥â (Á¥ÄÂøµÊó•)', category: 'highlight', loc: 'Kusatsu Onsen' }
                                ]},
                                { weekday: 'Wed', dateStr: '11/04', events: [
                                    { time: '13:00', title: 'Ê≤≥Âè£Êπñ', desc: 'Â§ßÁü≥ÂÖ¨Âúí', category: 'sightseeing', loc: 'Kawaguchiko' },
                                    { time: '14:30', title: 'Á¥ÖËëâËø¥Âªä', desc: 'Á¥ÖËëâÈößÈÅì', category: 'sightseeing', loc: 'Momiji Corridor' },
                                    { time: '16:30', title: 'Check-in', desc: 'HOTEL CLAD (Âæ°ÊÆøÂ†¥)', category: 'hotel', loc: 'Gotemba' }
                                ]},
                                { weekday: 'Thu', dateStr: '11/05', events: [
                                    { time: '06:30', title: 'Â±±‰∏≠Êπñ', desc: 'ÈÄÜÂØåÂ£´', category: 'sightseeing', loc: 'Yamanakako' },
                                    { time: '10:00', title: 'Âæ°ÊÆøÂ†¥ Outlet', desc: 'Shopping', category: 'shopping', loc: 'Gotemba Outlet' },
                                    { time: '18:00', title: 'Êù±‰∫¨ÈÇÑËªä', desc: 'Ê∑∫Ëçâ/‰∏äÈáé', category: 'transport', loc: 'Asakusa' },
                                    { time: '19:30', title: 'È≥•Ë≤¥Êóè', desc: 'ÊôöÈ§ê', category: 'food', loc: 'Torikizoku' }
                                ]},
                                { weekday: 'Fri', dateStr: '11/06', events: [
                                    { time: '10:00', title: 'ÈäÄÂ∫ß / ÊæÄË∞∑ Sky', desc: 'ËßÄÊôØÂè∞', category: 'sightseeing', loc: 'Shibuya Sky' },
                                    { time: '16:30', title: 'Êù±‰∫¨ÈêµÂ°î', desc: 'ÂÅúËªäÂ†¥ÊâìÂç°‰Ωç', category: 'sightseeing', loc: 'Tokyo Tower' },
                                    { time: '19:00', title: 'Mantensushi', desc: '10+1 Á¥ÄÂøµ Omakase', category: 'highlight', loc: 'Nihonbashi' }
                                ]},
                                { weekday: 'Sat', dateStr: '11/07', events: [
                                    { time: '10:30', title: 'ÂêâÁ••ÂØ∫', desc: '‰∫ï‰πãÈ†≠ÂÖ¨Âúí', category: 'sightseeing', loc: 'Kichijoji' },
                                    { time: '14:00', title: '‰∏ãÂåóÊæ§', desc: 'Âè§ËëóÂ∫ó', category: 'shopping', loc: 'Shimokitazawa' }
                                ]},
                                { weekday: 'Sun', dateStr: '11/08', events: [
                                    { time: '10:00', title: 'ÊúÄÂæåË°ùÂà∫', desc: 'Ê∑∫Ëçâ/‰∏äÈáé', category: 'shopping', loc: 'Ueno' },
                                    { time: '14:00', title: 'Skyliner', desc: '‰∏äÈáé -> ÊàêÁî∞', category: 'transport', loc: 'Ueno Station' },
                                    { time: '18:00', title: 'ÂõûÁ®ã', desc: 'CX505', category: 'flight', loc: 'Narita Airport' }
                                ]}
                            ]
                        }
                    },
                    
                    tabs: [
                        { id: 'itinerary', name: 'Ë°åÁ®ã', icon: 'fa-solid fa-location-dot' },
                        { id: 'info', name: 'Ë≥áË®ä', icon: 'fa-solid fa-circle-info' },
                        { id: 'shopping', name: 'Ë≥ºÁâ©', icon: 'fa-solid fa-bag-shopping' },
                        { id: 'expenses', name: 'Ë®òÂ∏≥', icon: 'fa-solid fa-wallet' },
                    ]
                }
            },
            computed: {
                activeTrip() {
                    return this.trips[this.selectedTripId];
                },
                currentTheme() {
                    return this.themes[this.activeTrip.theme];
                },
                currentEffect() {
                    return this.activeTrip.effect;
                },
                currentDayEvents() {
                    return this.activeTrip.days[this.selectedDayIndex].events || [];
                },
                effectIcon() {
                    if (this.currentEffect === 'flower') return 'fa-solid fa-fan'; 
                    if (this.currentEffect === 'leaf') return 'fa-brands fa-canadian-maple-leaf'; 
                    return '';
                },
                totalExpenses() {
                    return this.activeTrip.expenses.reduce((sum, item) => sum + parseInt(item.amount || 0), 0);
                }
            },
            watch: {
                selectedDayIndex() {
                    this.fetchWeather();
                },
                selectedTripId() {
                    this.fetchWeather();
                }
            },
            mounted() {
                this.fetchWeather();
            },
            methods: {
                selectTrip(id) {
                    this.selectedTripId = id;
                    this.currentView = 'detail';
                    this.activeTab = 'itinerary';
                    this.selectedDayIndex = 0; // Reset to Day 1
                },
                fetchWeather() {
                    let query = this.activeTrip.weatherCity;
                    fetch(`https://api.openweathermap.org/data/2.5/weather?q=${query}&units=metric&lang=zh_tw&appid=${this.apiKey}`)
                    .then(res => res.json())
                    .then(data => {
                        this.weather.city_name = data.name;
                        this.weather.temp = Math.round(data.main.temp);
                        this.weather.feels_like = Math.round(data.main.feels_like);
                        this.weather.icon = 'fa-sun'; // default
                    })
                    .catch(() => { this.weather.temp = '--'; });
                },
                getCountdown(dateString) {
                    const target = new Date(dateString);
                    const now = new Date();
                    const diff = target - now;
                    return Math.ceil(diff / (1000 * 60 * 60 * 24));
                },
                itemCategoryName(cat) {
                    const map = { sightseeing: 'ÊôØÈªû', food: 'ÁæéÈ£ü', shopping: 'Ë≥ºÁâ©', transport: '‰∫§ÈÄö', hotel: '‰ΩèÂÆø', flight: 'Ëà™Áè≠', ticket: 'ÈñÄÁ•®', highlight: 'Á¥ÄÂøµÊó•' };
                    return map[cat] || 'ÂÖ∂‰ªñ';
                },
                getTransportIcon(type) {
                    const map = { walk: 'fa-person-walking', train: 'fa-train-subway', car: 'fa-car', bus: 'fa-bus', flight: 'fa-plane' };
                    return `fa-solid ${map[type] || 'fa-arrow-right'}`;
                },
                openMap(location) {
                    if (location) {
                        window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location)}`, '_blank');
                    }
                },
                addShoppingItem() { if(this.newShopItem) this.activeTrip.shopping.push(this.newShopItem); this.newShopItem = ''; },
                removeShoppingItem(idx) { this.activeTrip.shopping.splice(idx, 1); },
                deleteExpense(idx) { this.activeTrip.expenses.splice(idx, 1); },
                
                openAddModal() { this.showModal = true; },
                confirmAdd() { 
                    if(this.newItem.title && this.currentView === 'detail') {
                        this.activeTrip.days[this.selectedDayIndex].events.push({...this.newItem});
                    }
                    this.showModal = false; 
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
