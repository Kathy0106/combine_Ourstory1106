<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æˆ‘çš„æ—…éŠæ‰‹å¸³ V98 (ä¿®æ­£ç‰ˆ)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-cream: #FFFDF7;
            --card-white: #FFFFFF;
            --text-brown: #5D4037;
            --text-light: #A1887F;
            --shadow-soft: 0 8px 24px rgba(149, 117, 205, 0.08);
        }

        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: var(--bg-cream);
            color: var(--text-brown);
            overscroll-behavior-y: none;
            -webkit-tap-highlight-color: transparent;
            font-size: 15px;
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* å¥¶æ²¹é¢¨å¡ç‰‡ + è™›ç·šé‚Šæ¡† */
        .cream-card {
            background-color: var(--card-white);
            border-radius: 24px;
            box-shadow: var(--shadow-soft);
            border: 2px dashed #E0D8C0;
        }

        .card-press:active { transform: scale(0.98); transition: transform 0.1s; }
        
        /* é£„è½å‹•ç•« */
        @keyframes fall {
            0% { transform: translateY(-10vh) translateX(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(110vh) translateX(20px) rotate(360deg); opacity: 0; }
        }
        .falling-item {
            position: fixed;
            top: -10%;
            user-select: none;
            pointer-events: none;
            z-index: 9998;
            animation-name: fall;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
            font-size: 1.5rem;
        }
        
        .trip-header-bg {
            background-size: cover;
            background-position: center;
            transition: all 0.3s ease;
        }

        .accordion-enter-active,
        .accordion-leave-active {
            transition: max-height 0.3s ease, opacity 0.3s ease;
            max-height: 500px;
            overflow: hidden;
        }
        .accordion-enter-from,
        .accordion-leave-to {
            max-height: 0;
            opacity: 0;
        }
    </style>
</head>
<body class="h-screen w-screen overflow-hidden">

    <div id="app" class="h-full flex flex-col relative transition-colors duration-700" :style="{ fontSize: settings.fontSize + 'px' }">

        <div v-if="currentEffect !== 'none'" class="absolute inset-0 overflow-hidden pointer-events-none z-[9998]">
            <div v-for="n in 12" :key="n" class="falling-item opacity-60" 
                 :style="{ 
                    left: Math.random() * 100 + 'vw', 
                    animationDuration: (Math.random() * 5 + 5) + 's', 
                    animationDelay: (Math.random() * 5) + 's',
                    color: currentTheme.main
                 }">
                {{ effectEmoji }}
            </div>
        </div>

        <div v-if="currentView === 'home'" class="flex-1 flex flex-col px-6 pt-10 pb-6 z-10 overflow-y-auto">
            
            <div class="mb-8 flex justify-between items-end">
                <div>
                    <h1 class="text-3xl font-bold" style="color: #5D4037;">æ—©æ™¨ï¼â˜€ï¸</h1>
                    <p class="text-sm mt-1" style="color: #A1887F;">æº–å‚™å¥½å‡ºç™¼æœªï¼Ÿâœˆï¸</p>
                </div>
                <button @click="showSettings = true" class="w-10 h-10 rounded-full bg-white shadow-sm flex items-center justify-center text-[#A1887F] hover:text-[#5D4037] transition-colors border-2 dashed border-[#E0D8C0]">
                    <i class="fa-solid fa-gear text-lg"></i>
                </button>
            </div>

            <div class="space-y-6">
                <div @click="selectTrip('karuizawa')" class="relative w-full aspect-[16/9] rounded-[30px] shadow-sm overflow-hidden card-press cursor-pointer group bg-white border-2 dashed border-[#E0D8C0]">
                    <div class="absolute inset-0 trip-header-bg opacity-90" :style="{ backgroundImage: `url(${trips.karuizawa.headerImg})` }"></div>
                    <div class="absolute inset-0 bg-gradient-to-t from-[#5D4037]/60 via-transparent to-transparent"></div>
                    <div class="absolute bottom-0 left-0 w-full p-5 text-white">
                        <div class="flex justify-between items-end">
                            <div>
                                <div class="text-[10px] font-bold bg-[#F48FB1] px-2 py-1 rounded-lg inline-block mb-2 shadow-sm text-white">ğŸŒ¸ æ«»èŠ±å­£</div>
                                <h3 class="text-xl font-bold mb-1 tracking-wide">{{ trips.karuizawa.name }}</h3>
                                <p class="text-[10px] opacity-90 font-mono"><i class="fa-solid fa-calendar mr-1"></i> {{ trips.karuizawa.range }}</p>
                            </div>
                            <div class="text-right">
                                <div class="text-[10px] opacity-90 mb-0.5">é‚„æœ‰</div>
                                <div class="text-3xl font-bold font-mono text-[#FFCDD2] drop-shadow-sm">{{ getCountdown(trips.karuizawa.date) }}</div>
                                <div class="text-[10px]">å¤©</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div @click="selectTrip('central')" class="relative w-full aspect-[16/9] rounded-[30px] shadow-sm overflow-hidden card-press cursor-pointer group bg-white border-2 dashed border-[#E0D8C0]">
                    <div class="absolute inset-0 trip-header-bg opacity-90" :style="{ backgroundImage: `url(${trips.central.headerImg})` }"></div>
                    <div class="absolute inset-0 bg-gradient-to-t from-[#5D4037]/60 via-transparent to-transparent"></div>
                    <div class="absolute bottom-0 left-0 w-full p-5 text-white">
                        <div class="flex justify-between items-end">
                            <div>
                                <div class="text-[10px] font-bold bg-[#FFB74D] px-2 py-1 rounded-lg inline-block mb-2 shadow-sm text-white">ğŸ ç´…è‘‰å­£</div>
                                <h3 class="text-xl font-bold mb-1 tracking-wide">{{ trips.central.name }}</h3>
                                <p class="text-[10px] opacity-90 font-mono"><i class="fa-solid fa-calendar mr-1"></i> {{ trips.central.range }}</p>
                            </div>
                            <div class="text-right">
                                <div class="text-[10px] opacity-90 mb-0.5">é‚„æœ‰</div>
                                <div class="text-3xl font-bold font-mono text-[#FFE0B2] drop-shadow-sm">{{ getCountdown(trips.central.date) }}</div>
                                <div class="text-[10px]">å¤©</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="currentView === 'detail'" class="flex-1 flex flex-col relative z-10 h-full">
            
            <div class="relative h-[28vh] min-h-[180px] max-h-[280px] flex-shrink-0 bg-cover bg-center transition-all duration-500 shadow-sm"
                 :style="{ backgroundImage: `url(${activeTrip.headerImg})` }">
                <div class="absolute inset-0 bg-gradient-to-b from-[#5D4037]/20 to-[#5D4037]/60"></div>
                
                <button @click="currentView = 'home'" class="absolute top-6 left-5 w-10 h-10 rounded-full bg-white/30 backdrop-blur-md flex items-center justify-center text-white z-50 hover:bg-white/40 transition shadow-sm border border-white/20">
                    <i class="fa-solid fa-arrow-left text-sm"></i>
                </button>
                
                 <button @click="showSettings = true" class="absolute top-6 right-5 w-10 h-10 rounded-full bg-white/30 backdrop-blur-md flex items-center justify-center text-white z-50 hover:bg-white/40 transition shadow-sm border border-white/20">
                    <i class="fa-solid fa-gear text-sm"></i>
                </button>

                <div class="absolute bottom-6 right-5 flex gap-2 z-20 bg-white/90 backdrop-blur-md p-1.5 rounded-full shadow-lg border border-white/50">
                    <button @click="activeTab = 'itinerary'" :class="getTabClass('itinerary')" :style="getTabStyle('itinerary')"><i class="fa-solid fa-map-location-dot text-base"></i></button>
                    <button @click="activeTab = 'info'" :class="getTabClass('info')" :style="getTabStyle('info')"><i class="fa-solid fa-circle-info text-base"></i></button>
                    <button @click="activeTab = 'shopping'" :class="getTabClass('shopping')" :style="getTabStyle('shopping')"><i class="fa-solid fa-basket-shopping text-base"></i></button>
                    <button @click="activeTab = 'expenses'" :class="getTabClass('expenses')" :style="getTabStyle('expenses')"><i class="fa-solid fa-yen-sign text-base"></i></button>
                </div>
                
                <div class="absolute bottom-8 left-6 text-white text-shadow pr-40">
                    <h1 class="text-xl font-bold tracking-widest leading-tight mb-1 drop-shadow-md">{{ activeTrip.name }}</h1>
                    <p class="text-[10px] opacity-90 font-mono"><i class="fa-solid fa-calendar mr-1"></i> {{ activeTrip.range }}</p>
                </div>
            </div>

            <div class="flex-1 rounded-t-[30px] -mt-6 relative z-10 overflow-hidden flex flex-col shadow-[0_-5px_25px_rgba(0,0,0,0.03)]" style="background-color: var(--bg-cream);">
                <div class="flex-1 overflow-y-auto no-scrollbar pb-24">

                    <div v-if="activeTab === 'itinerary'">
                        
                        <div class="sticky top-0 z-40 bg-[#FFFDF7]/95 backdrop-blur-md shadow-sm border-b-2 border-dashed border-[#F0EBE0] px-5 pt-4 pb-2 transition-all duration-300">
                            
                            <div class="flex justify-between items-center mb-4">
                                <div class="flex items-center gap-2">
                                    <span class="text-xs font-bold bg-white px-2 py-1 rounded-lg border-2 dashed border-[#F0EBE0] text-[#A1887F]">é‚„æœ‰</span>
                                    <span class="text-4xl font-black font-mono" :style="{ color: currentTheme.main }">
                                        {{ getCountdown(activeTrip.date) }} <span class="text-xs text-[#A1887F] font-sans font-normal">å¤©</span>
                                    </span>
                                </div>
                                <div class="text-center">
                                    <span class="text-xs font-bold text-[#A1887F] block uppercase">{{ activeTrip.days[selectedDayIndex].weekday }}</span>
                                    <span class="text-2xl font-bold text-[#5D4037]">{{ activeTrip.days[selectedDayIndex].dateStr.split(' ')[0] }}</span>
                                </div>
                                <div class="text-right flex flex-col items-end">
                                    <div class="flex items-center gap-1">
                                        <div class="text-xl font-bold text-[#5D4037]">{{ weather.temp }}Â°</div>
                                        <i :class="['fa-solid', weather.icon, 'text-2xl']" :style="{ color: currentTheme.main }"></i>
                                    </div>
                                    <div class="text-[10px] text-[#A1887F]">{{ weather.city_name }}</div>
                                </div>
                            </div>
                            
                            <div class="flex space-x-3 overflow-x-auto no-scrollbar pb-2">
                                <div v-for="(day, index) in activeTrip.days" :key="index" 
                                     @click="selectedDayIndex = index"
                                     class="flex-shrink-0 flex flex-col items-center justify-center w-20 h-20 rounded-2xl transition-all duration-300 snap-center cursor-pointer border-2 border-dashed shadow-sm"
                                     :class="selectedDayIndex === index ? 'text-white scale-105 shadow-md' : 'bg-white border-[#F0EBE0] text-[#A1887F]'"
                                     :style="selectedDayIndex === index ? { backgroundColor: currentTheme.main, borderColor: currentTheme.main } : {}">
                                    <span class="text-xs font-bold uppercase mb-0.5">{{ day.weekday }}</span>
                                    <span class="text-3xl font-black">{{ day.dateStr.split('/')[1] }}</span>
                                    <span class="text-[10px] opacity-80 mt-0.5">Day {{ index + 1 }}</span>
                                </div>
                            </div>

                            <div class="bg-yellow-50 border-t-2 border-dashed border-yellow-200 text-yellow-800 text-xs font-black py-2 text-center shadow-inner tracking-wide">
                                <i class="fa-solid fa-circle-exclamation mr-1 text-yellow-600"></i>
                                å°èˆªè²¼å£«ï¼šæœ‰é›»è©±ç”¨é›»è©± ğŸ“ â” å†‡å…ˆç”¨ Mapcode ğŸ“
                            </div>
                        </div>

                        <div class="px-5 pt-4 space-y-4 relative">
                            <div class="absolute left-[26px] top-4 bottom-4 w-0.5 border-l-2 border-dashed border-[#D7CCC8] z-0"></div>

                            <div v-for="(item, idx) in currentDayEvents" :key="idx" class="relative pl-12 group">
                                <div class="absolute left-[9px] top-4 w-9 h-9 rounded-full bg-white border-4 flex items-center justify-center z-10 shadow-sm font-bold text-[10px]" 
                                     :style="{ borderColor: '#FFF', color: '#FFF', backgroundColor: currentTheme.main }">
                                    {{ item.time.split(':')[0] }}
                                </div>

                                <div class="cream-card p-4 relative overflow-hidden transition-all active:scale-95" @click="openMap(item.loc)">
                                    
                                    <div class="flex gap-2">
                                        <div class="flex-1 min-w-0">
                                            <div class="flex justify-between items-start mb-1.5">
                                                <div class="text-[10px] font-bold uppercase tracking-wider opacity-60 text-[#8D6E63]">{{ item.time }} â€¢ {{ itemCategoryName(item.category) }}</div>
                                            </div>
                                            <h3 class="text-lg font-bold mb-1.5 leading-tight text-[#5D4037]">{{ item.title }}</h3>
                                            <div class="text-xs text-[#8D6E63] mb-2 flex items-start gap-1.5 leading-relaxed whitespace-pre-line" v-if="item.desc" v-html="formatText(item.desc)"></div>

                                            <div class="flex flex-wrap gap-1.5 mt-2">
                                                <span v-if="idx < currentDayEvents.length" class="text-[9px] bg-[#ECEFF1] text-[#78909C] px-2 py-1 rounded-lg font-bold flex items-center gap-1 border border-dashed border-[#CFD8DC]">
                                                    <i :class="getTransportIcon(item.transportType)"></i> {{ item.travelTime || 'ç§»å‹•' }}
                                                </span>
                                                <span v-if="item.loc" class="text-[9px] bg-[#E3F2FD] text-[#42A5F5] px-2 py-1 rounded-lg font-bold border border-dashed border-[#BBDEFB]">
                                                    <i class="fa-solid fa-location-arrow mr-0.5"></i>å°èˆª
                                                </span>
                                            </div>
                                        </div>

                                        <div v-if="item.mapcode || item.phone" class="w-24 flex-shrink-0 flex flex-col gap-2 justify-start mt-1">
                                            
                                            <div v-if="item.mapcode" class="bg-white border-2 rounded-lg p-1.5 text-center shadow-sm" @click.stop :style="{ borderColor: currentTheme.main }">
                                                <div class="text-[9px] font-bold mb-0.5 uppercase tracking-tighter" :style="{ color: currentTheme.main }">MapCode</div>
                                                <div class="text-xs font-black text-slate-800 break-all leading-tight mb-1">{{ item.mapcode }}</div>
                                                <div class="text-white text-[9px] rounded px-1 py-0.5 font-bold cursor-pointer active:scale-95" :style="{ backgroundColor: currentTheme.main }">COPY</div>
                                            </div>

                                            <div v-if="item.phone" class="bg-white border-2 rounded-lg p-1.5 text-center shadow-sm" @click.stop :style="{ borderColor: currentTheme.main }">
                                                <div class="text-[9px] font-bold mb-0.5 uppercase" :style="{ color: currentTheme.main }">TEL</div>
                                                <div class="text-xs font-black text-slate-800 break-all leading-tight">{{ item.phone }}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div v-if="currentDayEvents.length === 0" class="text-center text-[#D7CCC8] py-12">
                                <i class="fa-solid fa-calendar-plus text-4xl mb-3 opacity-30"></i>
                                <p class="text-xs font-bold">ä»Šå¤©é‚„æ²’æœ‰å®‰æ’è¡Œç¨‹å–”ï¼</p>
                            </div>
                        </div>
                    </div>

                    <div v-if="activeTab === 'info'" class="space-y-5 px-5 pt-4">
                         <div class="cream-card overflow-hidden border-2 dashed border-[#BBDEFB] cursor-pointer hover:opacity-90" @click="openDoc">
                            <div class="p-4 flex items-center justify-center gap-2 bg-[#4285F4] text-white font-bold rounded-xl shadow-md">
                                <i class="fa-brands fa-google-drive text-lg"></i>
                                <span class="text-sm">æŸ¥çœ‹å®Œæ•´ Google Doc è¡Œç¨‹</span>
                            </div>
                        </div>
                        
                        <div class="space-y-3">
                            <h3 class="font-bold text-[#A1887F] ml-1 text-sm">ä½å®¿åˆ—è¡¨</h3>
                            <div v-for="hotel in activeTrip.hotels" :key="hotel.name" class="cream-card p-4 flex items-center gap-4 cursor-pointer" @click="openMap(hotel.name)">
                                <div class="w-10 h-10 rounded-full flex items-center justify-center text-white text-lg shadow-sm" :style="{ backgroundColor: currentTheme.main }">
                                    <i class="fa-solid fa-bed"></i>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-bold text-sm text-[#5D4037]">{{ hotel.name }}</h4>
                                    <p class="text-xs text-[#A1887F] mt-0.5">{{ hotel.dates }}</p>
                                </div>
                                <i class="fa-solid fa-chevron-right text-[#D7CCC8] text-xs"></i>
                            </div>
                        </div>
                        
                        <div class="cream-card overflow-hidden" v-if="activeTrip.rental">
                            <div class="p-4 font-bold flex justify-between text-sm" style="background-color: #E3F2FD; color: #1976D2;">
                                <span><i class="fa-solid fa-car mr-2"></i>ç§Ÿè»Šè³‡è¨Š</span>
                            </div>
                            <div class="p-5 space-y-4 text-sm bg-white">
                                <div class="flex justify-between items-center border-b border-dashed border-[#E0E0E0] pb-2">
                                    <span class="text-[#90A4AE] text-xs">å…¬å¸/è»Šå‹</span>
                                    <span class="text-sm font-bold text-[#5D4037]">{{ activeTrip.rental.company }}</span>
                                </div>
                                <div class="flex gap-3">
                                    <div class="flex-1 bg-[#F1F8E9] p-3 rounded-xl border border-dashed border-[#DCEDC8] text-center">
                                        <p class="text-[#558B2F] text-[10px] mb-1 font-bold">å–è»Š</p>
                                        <p class="text-base font-black text-[#33691E] whitespace-pre-line leading-tight mb-1">{{ activeTrip.rental.pickupDate }}</p>
                                        <p class="text-sm font-bold text-[#1B5E20] mt-1">{{ activeTrip.rental.pickupLocName }}</p>
                                    </div>
                                    <div class="flex-1 bg-[#FFEBEE] p-3 rounded-xl border border-dashed border-[#FFCDD2] text-center">
                                        <p class="text-[#C62828] text-[10px] mb-1 font-bold">é‚„è»Š</p>
                                        <p class="text-base font-black text-[#B71C1C] whitespace-pre-line leading-tight mb-1">{{ activeTrip.rental.returnDate }}</p>
                                        <p class="text-sm font-bold text-[#B71C1C] mt-1">{{ activeTrip.rental.returnLocName }}</p>
                                    </div>
                                </div>
                                <div v-if="activeTrip.rental.note" class="text-xs text-red-500 bg-red-50 p-2 rounded border border-dashed border-red-200">
                                    <i class="fa-solid fa-circle-exclamation mr-1"></i> {{ activeTrip.rental.note }}
                                </div>
                            </div>
                        </div>

                         <div class="cream-card p-5">
                            <h3 class="font-bold mb-3 text-sm" :style="{ color: currentTheme.main }"><i class="fa-solid fa-coins mr-2"></i>åŒ¯ç‡æ›ç®— (JPY)</h3>
                            <div class="flex items-center gap-3 mb-2">
                                <div class="flex-1 bg-[#F5F5F5] rounded-xl p-3 flex items-center border border-dashed border-[#E0E0E0]">
                                    <span class="text-[#A1887F] mr-2 text-xs font-bold">JPY</span>
                                    <input type="number" v-model="calcJpy" @input="convert('jpy')" class="w-full bg-transparent outline-none font-bold text-lg text-[#5D4037]" placeholder="0">
                                </div>
                                <i class="fa-solid fa-arrow-right-arrow-left text-[#D7CCC8] text-xs"></i>
                                <div class="flex-1 bg-[#F5F5F5] rounded-xl p-3 flex items-center border border-dashed border-[#E0E0E0]">
                                    <span class="text-[#A1887F] mr-2 text-xs font-bold">HKD</span>
                                    <input type="number" v-model="calcHkd" @input="convert('hkd')" class="w-full bg-transparent outline-none font-bold text-lg text-[#5D4037]" placeholder="0">
                                </div>
                            </div>
                            <div class="text-right text-[10px] text-[#A1887F]">åŒ¯ç‡: {{ exchangeRate }}</div>
                        </div>
                    </div>

                    <div v-if="activeTab === 'shopping'" class="px-5 pt-4">
                         <div class="cream-card p-5 mb-4">
                            <h3 class="font-bold mb-3 text-sm text-[#5D4037]">å¾…è³¼æ¸…å–®</h3>
                             <div class="space-y-2">
                                <div v-for="(item, idx) in activeTrip.shopping" :key="idx" class="flex items-center gap-3 p-3 bg-[#FAFAFA] border border-dashed border-[#EEEEEE] rounded-xl">
                                    <input type="checkbox" class="w-5 h-5 rounded border-[#BDBDBD] accent-[#F48FB1]">
                                    <span class="text-sm font-bold text-[#5D4037]">{{ item }}</span>
                                    <button @click="removeShoppingItem(idx)" class="ml-auto text-[#D7CCC8] hover:text-[#EF5350]"><i class="fa-solid fa-trash"></i></button>
                                </div>
                                <div class="flex gap-2 mt-4">
                                    <input v-model="newShopItem" placeholder="æ–°å¢ç‰©å“..." class="flex-1 bg-[#F5F5F5] p-3 rounded-xl text-sm outline-none text-[#5D4037]">
                                    <button @click="addShoppingItem" class="w-10 h-10 rounded-xl text-white flex items-center justify-center shadow-md active:scale-95 text-lg" :style="{ backgroundColor: currentTheme.main }"><i class="fa-solid fa-plus"></i></button>
                                </div>
                            </div>
                         </div>
                    </div>
                    <div v-if="activeTab === 'expenses'" class="px-5 pt-4">
                         <div class="cream-card p-6 mb-4 text-center border-none" :style="{ backgroundColor: currentTheme.main }">
                            <p class="text-xs text-white/80 mb-1">ç¸½èŠ±è²» (æ—¥å…ƒ)</p>
                            <div class="text-4xl font-bold text-white mb-1">Â¥{{ totalExpenses.toLocaleString() }}</div>
                             <p class="text-[10px] text-white/60">â‰ˆ HK$ {{ (totalExpenses * exchangeRate).toFixed(0) }}</p>
                        </div>
                        <button class="w-full mt-4 py-3 rounded-xl text-white font-bold shadow-md active:scale-95 text-sm" :style="{ backgroundColor: currentTheme.main }">è¨˜ä¸€ç­†</button>
                    </div>

                </div>
            </div>
        </div>

        <button v-if="currentView === 'detail' && activeTab === 'itinerary'" @click="openAddModal" class="absolute bottom-8 right-5 w-14 h-14 rounded-full shadow-lg flex items-center justify-center text-2xl z-50 text-white transition-transform active:scale-90" :style="{ backgroundColor: currentTheme.main }">
            <i class="fa-solid fa-plus"></i>
        </button>

        <div v-if="showModal" class="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/50 backdrop-blur-sm" @click.self="showModal = false">
            <div class="bg-white w-full sm:w-96 rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl animate-slide-up">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-bold text-[#5D4037]">æ–°å¢é …ç›®</h3>
                    <button @click="showModal = false" class="text-[#BDBDBD]"><i class="fa-solid fa-xmark text-lg"></i></button>
                </div>
                <div class="space-y-4">
                    <input v-model="newItem.title" type="text" placeholder="æ¨™é¡Œ / é …ç›®åç¨±" class="w-full p-3 bg-[#F5F5F5] rounded-xl border-none outline-none text-sm text-[#5D4037]">
                    <div class="flex gap-2">
                        <input v-model="newItem.time" type="time" class="w-1/3 p-3 bg-[#F5F5F5] rounded-xl outline-none text-sm text-[#5D4037]">
                        <select v-model="newItem.category" class="w-2/3 p-3 bg-[#F5F5F5] rounded-xl outline-none text-sm text-[#5D4037]">
                            <option value="sightseeing">æ™¯é»</option>
                            <option value="food">ç¾é£Ÿ</option>
                            <option value="shopping">è³¼ç‰©</option>
                        </select>
                    </div>
                </div>
                <button @click="confirmAdd" class="w-full text-white font-bold py-3 rounded-xl mt-6 shadow-lg text-sm" :style="{ backgroundColor: currentTheme.main }">ç¢ºèªæ–°å¢</button>
            </div>
        </div>

        <div v-if="showSettings" class="fixed inset-0 z-[9999] bg-black/50 backdrop-blur-sm flex items-end sm:items-center justify-center" @click.self="showSettings = false">
            <div class="bg-white w-full sm:w-96 rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl animate-slide-up">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-bold text-[#5D4037]">è¨­å®š</h3>
                    <button @click="showSettings = false" class="text-[#BDBDBD]"><i class="fa-solid fa-xmark text-lg"></i></button>
                </div>
                <div class="mb-6">
                    <div class="flex justify-between mb-2">
                        <span class="text-sm font-bold text-[#A1887F]">å­—é«”å¤§å°</span>
                        <span class="text-xs text-[#BDBDBD]">{{ settings.fontSize }}px</span>
                    </div>
                    <input type="range" min="12" max="24" step="1" v-model="settings.fontSize" class="w-full accent-[#A1887F]">
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    currentView: 'home', selectedTripId: 'karuizawa', activeTab: 'itinerary', selectedDayIndex: 0,
                    showModal: false, showSettings: false, alarmsOpen: false, newShopItem: '',
                    exchangeRate: 0.053, calcJpy: '', calcHkd: '',
                    weather: { city_name: '', temp: '--', feels_like: '--', icon: 'fa-spinner fa-spin' },
                    apiKey: 'cc2dab2806da14aec6dab2ed8260a1c4',
                    settings: { themeColor: 'pink', effect: 'flower', fontSize: 14 },
                    themes: { pink: { main: '#F48FB1', bg: '#FFF0F5' }, orange: { main: '#FFB74D', bg: '#FFF8E1' } },

                    trips: {
                        karuizawa: {
                            id: 'karuizawa', name: 'æ±äº¬æ«»èŠ±ä¹‹æ—… 2026', date: '2026-04-18', range: 'Apr 18 - 25, 2026',
                            theme: 'pink', effect: 'flower', headerImg: './header_karuizawa.jpg',
                            docLink: 'https://docs.google.com/document/d/1-4mgjTycE9bGWhuitIkigPSM4_0fBPlZX2RoVRCTlXw/edit?usp=drivesdk',
                            weatherCity: 'Karuizawa,JP',
                            flights: { out: { code: 'CX524', date: '4/18', dep: '01:30', arr: '06:40' }, in: { code: 'CX501', date: '4/25', dep: '21:30', arr: '02:00' } },
                            rental: {
                                company: 'Toyota Rent a Car', pickupDate: '4/20', pickupTime: '09:30', pickupLocName: 'T-CAT (æ°´å¤©å®®)',
                                returnDate: '4/22', returnTime: '17:00', returnLocName: 'T-CAT (æ°´å¤©å®®)', pickupLoc: 'Toyota Rent a Car T-CAT', insurance: 'NOC å®‰å¿ƒä¿éšª', no: '98147748300', note: ''
                            },
                            hotels: [
                                { name: 'VIA INN PRIME æ—¥æœ¬æ©‹äººå½¢ç”º', dates: '4/18 - 4/20' },
                                { name: 'Toyoko Inn ä½ä¹…å¹³ç«™æ·ºé–“å£', dates: '4/20 - 4/22' },
                                { name: 'å…«é‡ç¿ æ±äº¬é…’åº—', dates: '4/22 - 4/25' }
                            ],
                            alarms: [
                                { date: 'å³åˆ»', task: 'è²·æ©Ÿç¥¨' }, { date: '1/20', task: 'Book è¼•äº•æ¾¤ç‡’è‚‰' }, { date: '3/23', task: 'æ¶ Disney Pass' }
                            ],
                            shopping: ['ä¿æš–è¥ª', 'éš±å½¢çœ¼é¡', 'Head dress', 'NuBra'],
                            expenses: [],
                            days: [
                                { weekday: 'Sat', dateStr: '4/18', events: [
                                    { time: '06:40', title: 'æŠµé”æˆç”° (NRT)', desc: 'æ©™è‰²æ«ƒå°è²·é£›å» T-CAT', category: 'flight', transportType: 'flight', location: 'Narita Airport' },
                                    { time: '07:45', title: 'åˆ©æœ¨æ´¥å·´å£« (Limousine Bus)', desc: 'å‰å¾€ T-CAT (æ°´å¤©å®®å‰)\nâš ï¸ å¤šè¡Œæå¿…æ­ï¼', category: 'transport', transportType: 'bus', travelTime: '75 min (60km)', location: 'T-CAT' },
                                    { time: '09:00', title: 'Check-in é…’åº—', desc: 'T-CAT è½‰çš„å£« (çŸ­é€”)', category: 'hotel', transportType: 'car', location: 'VIA INN PRIME Nihonbashi' },
                                    { time: '11:00', title: 'åˆ©ä¹…ç‰›èˆŒ (ç‰›ãŸã‚“ç‚­ç„¼ åˆ©ä¹…)', desc: 'ä¸Šé‡ Parco_ya 6F', category: 'food', loc: 'Rikyu Ueno', transportType: 'train', travelTime: '30 min', location: 'Rikyu Ueno' },
                                    { time: '15:30', title: 'é¾œæˆ¶å¤©ç¥ç¤¾ (Kameido Tenjin)', desc: 'ç´«è—¤èŠ± (éŒ¦ç³¸ç”ºè¡Œéå»)', category: 'sightseeing', loc: 'Kameido Tenjin', transportType: 'train', travelTime: '20 min', location: 'Kameido Tenjin' },
                                    { time: '17:00', title: 'ç±³ä¹…æœ¬åº— (Yonekyu)', desc: 'ç™¾å¹´ç‰›é‹', category: 'food', loc: 'Yonekyu Honten', transportType: 'walk', travelTime: '10 min', location: 'Yonekyu Honten' }
                                ]},
                                { weekday: 'Sun', dateStr: '4/19', events: [
                                    { time: '07:30', title: 'å‡ºç™¼ Patam', desc: 'æ—©èµ·é³¥å…’æœ‰è¢‹è²·ï¼', category: 'transport', loc: 'Patam Asakusa', transportType: 'train', travelTime: '15 min', location: 'Patam Asakusa' },
                                    { time: '07:45', title: 'Patam Asakusa æ’éšŠæˆ°å½¹', desc: 'ğŸ¯ ç›®æ¨™ï¼šæ¶é ­ç±Œè²·æ—¥æœ¬å¸ƒè¢‹ï¼\nğŸ“¸ å®˜æ–¹å…¬å‘Šï¼š<span class="highlight-blue">09:45 æ´¾ç±Œ (æ•´ç†åˆ¸)</span>\nâš ï¸ æˆ°ç•¥ï¼š07:45 åˆ°é”æ’éšŠï¼Œç¢ºä¿ç¬¬ä¸€æ‰¹å…¥å»ã€‚\nğŸ›ï¸ è²·å®Œå³é–ƒå»è¡¨åƒé“é£Ÿ Lunchã€‚', category: 'shopping', loc: 'Patam Asakusa', transportType: 'walk', location: 'Patam Asakusa' },
                                    { time: '12:30', title: 'å±±ç¬‘ãµ (Yama Warau)', desc: 'è¡¨åƒé“åº— Shabu Shabu (å·²é ç´„)\nâš ï¸ 11:30 å¿…é ˆç”±æ·ºè‰æ’¤é€€ï¼', category: 'food', loc: 'Yama Warau Omotesando', transportType: 'train', travelTime: '45 min', location: 'Yama Warau Omotesando' },
                                    { time: '14:30', title: 'Harakado', desc: '7F å±‹é ‚èŠ±åœ’', category: 'sightseeing', loc: 'Harakado', transportType: 'walk', travelTime: '5 min', location: 'Harakado' },
                                    { time: '19:00', title: 'ç‰›ã‹ã¤ã‚‚ã¨æ‘', desc: 'æ¾€è°·åˆ†åº— ç‚¸ç‰›æ’', category: 'food', loc: 'Gyukatsu Motomura Shibuya', transportType: 'walk', travelTime: '20 min', location: 'Gyukatsu Motomura Shibuya' }
                                ]},
                                { weekday: 'Mon', dateStr: '4/20', events: [
                                    { time: '09:00', title: 'Check-out', desc: 'è¡Œå» T-CAT', category: 'other', loc: 'T-CAT', transportType: 'walk', travelTime: '10 min', location: 'T-CAT' },
                                    { time: '09:30', title: 'å–è»Š', desc: 'Toyota T-CAT', category: 'transport', loc: 'Toyota Rent a Car T-CAT', transportType: 'walk', location: 'Toyota Rent a Car T-CAT' },
                                    { time: '10:30', title: 'ä¸‰èŠ³ PA', desc: 'ä¼‘æ¯ç«™', category: 'transport', loc: 'Miyoshi PA', transportType: 'car', travelTime: '60 min', mapcode: '33 444 555*66', location: 'Miyoshi PA' },
                                    { time: '13:00', title: 'è¼•äº•æ¾¤åˆé¤', desc: 'Option A: å·ä¸Šåºµ\nOption B: æ‘æ°‘é£Ÿå ‚', category: 'food', loc: 'Karuizawa', transportType: 'car', travelTime: '90 min', mapcode: '292 701 462*82', location: 'Karuizawa Hoshino Area' },
                                    { time: '14:30', title: 'Outlet Shopping', desc: 'MC: 292 677 245*55 (æ³Š P7)', category: 'shopping', loc: 'Prince Shopping Plaza', transportType: 'car', travelTime: '20 min', mapcode: '292 677 245*55', location: 'Prince Shopping Plaza' },
                                    { time: '18:00', title: 'Check-in (Toyoko Inn)', category: 'hotel', loc: 'Toyoko Inn Sakudaira', transportType: 'car', travelTime: '40 min', mapcode: '85 748 837*33', phone: '0267-66-1045', location: 'Toyoko Inn Sakudaira' }
                                ]},
                                { weekday: 'Tue', dateStr: '4/21', events: [
                                    { time: '08:00', title: 'Pre-wedding', desc: 'å…¨æ—¥æ‹æ” (è‡ªé§•ç§»å‹•)', category: 'highlight', loc: 'Karuizawa', transportType: 'car', travelTime: 'å…¨æ—¥', location: 'Karuizawa' },
                                    { time: '19:00', title: 'æ…¶åŠŸæ™šé¤', desc: 'å·ä¸Šåºµ æˆ– ç‡’è‚‰', category: 'food', loc: 'Karuizawa', transportType: 'car', travelTime: '15 min', location: 'Karuizawa' },
                                    { time: '21:00', title: 'å›ç¨‹é…’åº—', category: 'hotel', desc: 'ä¼‘æ¯', transportType: 'car', location: 'Toyoko Inn Sakudaira' }
                                ]},
                                { weekday: 'Wed', dateStr: '4/22', events: [
                                    { time: '10:00', title: 'ç™½çµ²ç€‘å¸ƒ', desc: 'MC: 292 701 645*63', category: 'sightseeing', loc: 'Shiraito Falls', transportType: 'car', travelTime: '45 min', mapcode: '292 701 645*63', location: 'Shiraito Falls' },
                                    { time: '11:00', title: 'Rogotei ç‡’è‚‰', desc: 'åˆé¤', category: 'food', loc: 'Rogotei', transportType: 'car', travelTime: '30 min', location: 'Rogotei', mapcode: '292 673 483*66' },
                                    { time: '12:30', title: 'èˆŠè¼•äº•æ¾¤éŠ€åº§é€š', desc: 'æƒè¡—', category: 'sightseeing', loc: 'Kyu-Karuizawa Ginza', transportType: 'car', travelTime: '15 min', location: 'Kyu-Karuizawa Ginza' },
                                    { time: '17:00', title: 'æ±äº¬é‚„è»Š', desc: 'T-CAT', category: 'transport', loc: 'T-CAT', transportType: 'car', travelTime: '2.5 hr', location: 'T-CAT' },
                                    { time: '18:00', title: 'Check-in (å…«é‡ç¿ )', category: 'hotel', loc: 'Yaekit', transportType: 'walk', location: 'Yaekit' }
                                ]},
                                { weekday: 'Thu', dateStr: '4/23', events: [
                                    { time: '06:45', title: 'å‡ºç™¼ Disney', desc: 'å…«ä¸å € ->èˆæ¿±', category: 'transport', loc: 'Maihama', transportType: 'train', travelTime: '45 min', location: 'Tokyo DisneySea' },
                                    { time: '08:30', title: 'Disney Sea', desc: 'æ¶ Standby Pass', category: 'ticket', loc: 'Tokyo DisneySea', transportType: 'walk', location: 'Tokyo DisneySea' },
                                    { time: '21:30', title: 'å›ç¨‹é…’åº— (å…«é‡ç¿ )', category: 'hotel', desc: 'ä¼‘æ¯', transportType: 'walk', location: 'Yaekit' }
                                ]},
                                { weekday: 'Fri', dateStr: '4/24', events: [
                                    { time: '09:30', title: 'å‰å¾€è±æ´²', desc: 'çš„å£«', category: 'transport', loc: 'Toyosu Market', transportType: 'car', travelTime: '15 min', location: 'Toyosu Market' },
                                    { time: '10:00', title: 'å¤§å’Œå£½å¸', desc: 'æ’éšŠ', category: 'food', loc: 'Daiwa Sushi', transportType: 'walk', location: 'Daiwa Sushi' },
                                    { time: '13:30', title: 'TeamLab Planets', desc: 'è±æ´²', category: 'sightseeing', loc: 'TeamLab Planets', transportType: 'walk', location: 'TeamLab Planets' },
                                    { time: '20:30', title: 'å›ç¨‹é…’åº—', category: 'hotel', desc: 'ä¼‘æ¯', transportType: 'train', location: 'Yaekit' }
                                ]},
                                { weekday: 'Sat', dateStr: '4/25', events: [
                                    { time: '10:30', title: 'æ±äº¬ä¸€ç•ªè¡—', desc: 'Shopping', category: 'shopping', loc: 'Tokyo Station', transportType: 'walk', location: 'Tokyo Station' },
                                    { time: '14:30', title: 'T-CAT å¯„è¡Œæ', desc: 'å»æ©Ÿå ´', category: 'transport', loc: 'T-CAT', transportType: 'car', location: 'T-CAT' },
                                    { time: '14:45', title: 'å‰å¾€æ©Ÿå ´ (CX501)', desc: 'å›ç¨‹', category: 'transport', loc: 'Narita Airport', transportType: 'bus', location: 'Narita Airport' }
                                ]}
                            ]
                        },
                        central: {
                            id: 'central', name: 'OurTrip 10+1', date: '2026-10-31', range: 'Oct 31 - Nov 08, 2026',
                            theme: 'orange', effect: 'leaf', headerImg: './header_central.jpg',
                            docLink: 'https://docs.google.com/document/d/11eFLaGqOmRfXx90pVCWGF0iNIQRwECa3X3VmFjqQgdk/edit?usp=drivesdk',
                            weatherCity: 'Nagoya,JP',
                            flights: { out: { code: 'CX524', date: '10/31', dep: '01:30', arr: '06:40' }, in: { code: 'CX505', date: '11/08', dep: '18:00', arr: '22:25' } },
                            rental: {
                                company: 'Toyota Rent a Car', pickupDate: '10/31', pickupTime: '08:00', pickupLocName: 'æˆç”°æ©Ÿå ´',
                                returnDate: '11/05', returnTime: '18:00', returnLocName: 'æ·ºè‰/ä¸Šé‡', pickupLoc: 'Toyota Rent a Car Narita', no: 'é ç´„ä¸­', insurance: 'NOC', note: 'å¿…é ˆé›ªèƒ'
                            },
                            hotels: [
                                { name: 'Daiwa Roynet Numazu', dates: '10/31 - 11/2' }, { name: 'Onyado Nono Matsumoto', dates: '11/2 - 11/3' },
                                { name: 'æ¹¯å®¿ å­£ä¹‹åº­ (è‰æ´¥)', dates: '11/3 - 11/4' }, { name: 'HOTEL CLAD (å¾¡æ®¿å ´)', dates: '11/4 - 11/5' }, { name: 'æ·ºè‰æ±æ­¦é…’åº—', dates: '11/5 - 11/8' }
                            ],
                            alarms: [
                                { date: '4/25', task: 'æ¶è¨‚ å­£ä¹‹åº­ & HOTEL CLAD' }, { date: '7/01', task: 'é ç´„ç§Ÿè»Š' },
                                { date: '9/01', task: 'æ¶ Mantensushi' }, { date: '9/30', task: 'é ç´„ é³¥è²´æ—' }
                            ],
                            shopping: ['æ²¼æ´¥ ä¹¾ç‰©', 'ä¼Šè±† å±±è‘µæ¼¬ç‰©', 'æ¾æœ¬ å‘³å™Œ', 'è‰æ´¥ æº«æ³‰ç²‰', 'å¾¡æ®¿å ´ Outlet'],
                            expenses: [],
                            days: [
                                { weekday: 'Sat', dateStr: '10/31', events: [
                                    { time: '11:30', title: 'æ²¼æ´¥æ¸¯ (ä¸¸å¤©)', category: 'food', loc: 'Numazu Port', transportType: 'car', mapcode: '650 583 339*01', location: 'Numazu Port' },
                                    { time: '13:30', title: 'ä¸‰å³¶å¤§åŠæ©‹', category: 'sightseeing', loc: 'Mishima Skywalk', transportType: 'car', mapcode: '50 238 668*85', location: 'Mishima Skywalk' },
                                    { time: '17:00', title: 'Check-in (Daiwa Roynet)', category: 'hotel', loc: 'Daiwa Roynet Numazu', transportType: 'car', mapcode: '50 073 112*71', location: 'Daiwa Roynet Numazu' },
                                    { time: '19:00', title: 'Sawayaka æ¼¢å ¡', category: 'food', loc: 'Sawayaka Numazu', transportType: 'walk', location: 'Sawayaka Numazu' }
                                ]},
                                { weekday: 'Sun', dateStr: '11/01', events: [
                                    { time: '10:30', title: 'å¤§å®¤å±±', category: 'sightseeing', loc: 'Omuro Mountain', transportType: 'car', mapcode: '48 846 512*63', location: 'Omuro Mountain' },
                                    { time: '14:30', title: 'ä¿®å–„å¯ºæº«æ³‰', category: 'sightseeing', loc: 'Shuzenji', transportType: 'car', mapcode: '16 186 084*42', location: 'Shuzenji' },
                                    { time: '19:00', title: 'é°»é­šé£¯ æ«»å®¶', category: 'food', loc: 'Sakuraya', transportType: 'car', phone: '055-975-4520', location: 'Sakuraya' }
                                ]},
                                { weekday: 'Mon', dateStr: '11/02', events: [
                                    { time: '11:00', title: 'è«è¨ªæ¹–', category: 'sightseeing', loc: 'Tateishi Park', transportType: 'car', mapcode: '75 236 391*70', location: 'Tateishi Park' },
                                    { time: '14:30', title: 'æ¾æœ¬åŸ', category: 'sightseeing', loc: 'Matsumoto Castle', transportType: 'car', mapcode: '75 851 375*66', location: 'Matsumoto Castle' },
                                    { time: '21:00', title: 'Check-in (Onyado Nono)', category: 'hotel', loc: 'Onyado Nono Matsumoto', transportType: 'walk', mapcode: '75 821 474*88', location: 'Onyado Nono Matsumoto' }
                                ]},
                                { weekday: 'Tue', dateStr: '11/03', events: [
                                    { time: '09:30', title: 'å–„å…‰å¯º', category: 'sightseeing', loc: 'Zenkoji', transportType: 'car', location: 'Zenkoji' },
                                    { time: '13:00', title: 'åœ°ç„è°·é‡çŒ¿å…¬è‹‘', category: 'sightseeing', loc: 'Snow Monkey Park', transportType: 'walk', location: 'Snow Monkey Park' },
                                    { time: '16:30', title: 'Check-in (å­£ä¹‹åº­)', category: 'highlight', loc: 'Tokinoniwa', transportType: 'car', mapcode: '341 448 004*52', location: 'Tokinoniwa' }
                                ]},
                                { weekday: 'Wed', dateStr: '11/04', events: [
                                    { time: '13:00', title: 'æ²³å£æ¹– (å¤§çŸ³å…¬åœ’)', category: 'sightseeing', loc: 'Oishi Park', transportType: 'car', mapcode: '161 303 446*52', location: 'Oishi Park' },
                                    { time: '16:30', title: 'Check-in (HOTEL CLAD)', category: 'hotel', loc: 'HOTEL CLAD', transportType: 'car', mapcode: '50 806 191*75', location: 'HOTEL CLAD' }
                                ]},
                                { weekday: 'Thu', dateStr: '11/05', events: [
                                    { time: '06:30', title: 'å±±ä¸­æ¹–é€†å¯Œå£«', category: 'sightseeing', loc: 'Nagaike Water Park', transportType: 'car', mapcode: '434 324 577*85', location: 'Nagaike Water Park' },
                                    { time: '10:00', title: 'å¾¡æ®¿å ´ Outlet', desc: 'Shopping', category: 'shopping', loc: 'Gotemba Outlet', transportType: 'car', travelTime: '40 min', location: 'Gotemba Outlet' },
                                    { time: '13:00', title: 'Lunch: Outlet Food Court / Shake Shack', category: 'food', loc: 'Gotemba Outlet', transportType: 'walk', location: 'Gotemba Outlet' },
                                    { time: '14:00', title: 'ç®±æ ¹ç¥ç¤¾', category: 'sightseeing', loc: 'Hakone Shrine', transportType: 'car', mapcode: '57 123 048*31', location: 'Hakone Shrine' },
                                    { time: '18:00', title: 'é‚„è»Š (æ·ºè‰)', category: 'transport', loc: 'Asakusa', transportType: 'car', location: 'Asakusa' },
                                    { time: '19:30', title: 'Dinner: é³¥è²´æ—', category: 'food', loc: 'Torikizoku Asakusa', transportType: 'walk', location: 'Torikizoku Asakusa' }
                                ]},
                                { weekday: 'Fri', dateStr: '11/06', events: [
                                    { time: '16:30', title: 'æ±äº¬éµå¡”', category: 'sightseeing', loc: 'Tokyo Tower', transportType: 'train', location: 'Tokyo Tower' },
                                    { time: '19:00', title: 'Mantensushi', category: 'highlight', loc: 'Mantensushi Nihonbashi', transportType: 'train', location: 'Mantensushi Nihonbashi' }
                                ]},
                                { weekday: 'Sat', dateStr: '11/07', events: [
                                    { time: '10:30', title: 'å‰ç¥¥å¯º', category: 'sightseeing', loc: 'Kichijoji', transportType: 'train', location: 'Kichijoji' },
                                    { time: '14:00', title: 'ä¸‹åŒ—æ¾¤', category: 'shopping', loc: 'Shimokitazawa', transportType: 'train', location: 'Shimokitazawa' }
                                ]},
                                { weekday: 'Sun', dateStr: '11/08', events: [
                                    { time: '14:00', title: 'Skyliner', category: 'transport', loc: 'Keisei Ueno', transportType: 'train', location: 'Keisei Ueno' },
                                    { time: '18:00', title: 'å›ç¨‹ (CX505)', category: 'flight', loc: 'Narita Airport', location: 'Narita Airport' }
                                ]}
                            ]
                        }
                    }
                }
            },
            watch: {
                selectedDayIndex() { this.fetchWeather(); },
                selectedTripId() { this.fetchWeather(); this.selectedDayIndex = 0; this.settings.themeColor = this.activeTrip.theme; },
                'settings.fontSize': function(newVal) { document.documentElement.style.fontSize = newVal + 'px'; }
            },
            mounted() {
                this.fetchWeather();
                document.documentElement.style.fontSize = this.settings.fontSize + 'px';
            },
            computed: {
                activeTrip() { return this.trips[this.selectedTripId]; },
                currentTheme() { return this.themes[this.activeTrip.theme]; },
                currentEffect() { return this.activeTrip.effect; },
                currentDayEvents() { return this.activeTrip.days[this.selectedDayIndex].events || []; },
                effectEmoji() { return this.currentEffect === 'flower' ? 'ğŸŒ¸' : 'ğŸ'; },
                totalExpenses() { return this.activeTrip.expenses ? this.activeTrip.expenses.reduce((sum, item) => sum + parseInt(item.amount || 0), 0) : 0; }
            },
            methods: {
                selectTrip(id) { this.selectedTripId = id; this.currentView = 'detail'; this.activeTab = 'itinerary'; },
                fetchWeather() { /* ... weather logic ... */ },
                getCountdown(dateString) { const target = new Date(dateString); const now = new Date(); return Math.ceil((target - now) / (1000 * 60 * 60 * 24)); },
                itemCategoryName(cat) { const map = { sightseeing: 'æ™¯é»', food: 'ç¾é£Ÿ', shopping: 'è³¼ç‰©', transport: 'äº¤é€š', hotel: 'ä½å®¿', flight: 'èˆªç­', ticket: 'é–€ç¥¨', highlight: 'ç´€å¿µæ—¥' }; return map[cat] || 'å…¶ä»–'; },
                getTransportIcon(type) { const map = { walk: 'fa-person-walking', train: 'fa-train-subway', car: 'fa-car', bus: 'fa-bus', flight: 'fa-plane' }; return `fa-solid ${map[type] || 'fa-arrow-right'}`; },
                getTabClass(tab) { return this.activeTab === tab ? `text-white w-10 h-10 rounded-full shadow-lg flex items-center justify-center transform scale-110 transition-all` : `bg-white/90 w-8 h-8 rounded-full shadow flex items-center justify-center hover:bg-white transition-all`; },
                getTabStyle(tab) { return this.activeTab === tab ? { backgroundColor: this.currentTheme.main } : { color: this.currentTheme.main }; },
                openMap(loc) { let query = loc; if (!query.includes('Japan')) query += ', Japan'; window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query)}`, '_blank'); },
                openDoc() { window.open(this.activeTrip.docLink, '_blank'); },
                addShoppingItem() { if(this.newShopItem) this.activeTrip.shopping.push(this.newShopItem); this.newShopItem = ''; },
                removeShoppingItem(idx) { this.activeTrip.shopping.splice(idx, 1); },
                openAddModal() { this.showModal = true; },
                confirmAdd() { if(this.newItem.title) { this.activeTrip.days[this.selectedDayIndex].events.push({...this.newItem}); } this.showModal = false; },
                formatText(text) { return text; }
            }
        }).mount('#app');
    </script>
</body>
</html>
